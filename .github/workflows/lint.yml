name: Linting

# Controls when the action will run. 
on:
  push:
     branches: [develop]
  workflow_dispatch:
  
jobs:
  linting:
    name: "Flint"
    runs-on: ubuntu-latest
    steps:
      - name: Setup env.
        run: |
          sudo apt-get update && sudo apt-get install python3-tk
          pip install flinter
          pip install anybadge
      - name: Checkout
        uses: actions/checkout@v2
        with:
          fetch-depth: 1
      - name: Lint
        run: |
          flint score src/
          flint score src/ -d 1 | tee flint.txt
          score=$(awk '$1==0{print $3}' flint.txt)
          echo $score
          anybadge -l flint  -o --file=flint.svg -v $score  2=red 4=orange 8=yellow 10=green
      - name: Archive linter badge
        uses: actions/upload-artifact@v2
        with:
          name: flint-badge
          path: flint.svg
          
          

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Neko: Input-output</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../doxygen-awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Neko<span id="projectnumber">&#160;1.99.2</span>
   </div>
   <div id="projectbrief">A portable framework for high-order spectral element flow simulations</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('d7/d7f/io.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Input-output</div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#autotoc_md123">Mesh</a></li>
<li class="level1"><a href="#autotoc_md124">Three-dimensional field output</a><ul><li class="level2"><a href="#autotoc_md125">Compression of field output</a></li>
</ul>
</li>
<li class="level1"><a href="#autotoc_md126">Checkpoint files</a></li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="autotoc_md123"></a>
Mesh</h1>
<p>Neko has its own mesh format, <code>.nmsh</code>. All meshes should be 3D and consist of hexahedral elements. A 2D or 1D case can be mimicked by having a single element across selected axes and applying periodic boundary conditions.</p>
<p>A native mesh generator for simple box meshes, called <code>genmeshbox</code>, is part of Neko, and is used in some of the examples, for example <code>advecting_cone</code>. The usage is straightforward, and is well described by the help string provided when running the utility.</p>
<p>The main way of obtaining a <code>.nmsh</code> is converting a Nek5000 <code>.<a class="el" href="../../dd/da1/namespacere2.html" title="NEKTON re2 format.">re2</a></code> mesh file using the <code>rea2nbin</code> utility. Nek5000, in turn, has several converters among its tools, such as <code>gmsh2nek</code>. The latter is also available under the <code>contrib</code> directory in Neko. The workflow is thus to export your mesh into a format, which can be converted to <code>.<a class="el" href="../../dd/da1/namespacere2.html" title="NEKTON re2 format.">re2</a></code>, and then convert the <code>.<a class="el" href="../../dd/da1/namespacere2.html" title="NEKTON re2 format.">re2</a></code> to <code>.nmsh</code>. Of course one can also use native Nek5000 tools to produce the <code>.<a class="el" href="../../dd/da1/namespacere2.html" title="NEKTON re2 format.">re2</a></code>, such as <code>genbox</code>. In the future, native support for other formats than <code>.nmsh</code> will be added for convenience.</p>
<p>It should be noted, that the <code>.<a class="el" href="../../dd/da1/namespacere2.html" title="NEKTON re2 format.">re2</a></code> format allows to store boundary conditions. This is relevant for users that have old Nek5000 cases, who wish to convert them to Neko. Boundary conditions are not converted by Neko as such, but the faces where they were applied are saved into regular boundary zones. The relevant conditions should then be prescribed in the case file as usual. Note also that periodic boundaries are directly encoded into the mesh file, and this will remain so in the future.</p>
<h1><a class="anchor" id="autotoc_md124"></a>
Three-dimensional field output</h1>
<p>Neko stores the 3D fields with results in the <code>.f#####</code> format, which is the same as in Nek5000. The advantage of adopting this format, is that there is a reader in Paraview and VisIt, which can be used to visualize them. Note that the latest version of Paraview actually has two readers for <code>.f#####</code>. For now, Neko has been thoroughly tested with the older reader, which uses VisIt under the hood. However, the new reader was used for the smaller cases as well. A file with the <code>.nek5000</code> extension is used as the entry point for the readers and stores some metadata. Users may also find the Python package <a href="https://github.com/ExtremeFLOW/pySEMTools"><code>pysemtools</code></a> useful for working with <code>.f#####</code>s. Note that only the first output <code>.f#####</code> file stores the mesh. Detailded description of the file format can be found in <a href="https://nek5000.github.io/NekDoc/problem_setup/case_files.html#restart-output-files-f">Nek5000 documentation</a>. Notice, for brievity in this manual we often call <code>.f#####</code> file format an <code>.fld</code> one and in some cases Neko even outputs files with <code>.fld</code> extension. However, in all cases we refer to the binary <code>.f#####</code> format and not to the Nek5000 text file format with the same extension.</p>
<h2><a class="anchor" id="autotoc_md125"></a>
Compression of field output</h2>
<p>Neko supports compression of the 3D field data when writing through the ADIOS2. If the ADIOS2 dependency was compiled with compression library support like BigWhoop, SZ, or ZFP the field output can be compressed using one of these lossy compressors (and other lossless compression techniques.) Using algorithms based on image compression, such as BigWhoop and ZFP, the local structure from higher order elements needs to be regarded. Setting <code>output\_layout=2</code> uses the implicit neighbourhood relations of DoFs in x,y,z in a 4D layout. The first three dimensions represent the DoFs and the fourth dimension refers to the number of elements in numeric order. This layout can be used for BigWhoop and ZFP. Additionally, benefits in compression efficiency can be observed for BigWhoop when packing and compressing field parameters together, effectively adding a fifth dimension for the number of field parameters. This layout is enabled when <code>output\_format=3</code>. (The default <code>output_layout=1</code> creates a contiguous 1D array access pattern equivalent to the data layout in the nek5000 files.)</p>
<p>The compression algorithms are controlled by an additional file <code>adios2.xml</code>. Please refer to the documentation of ADIOS2 (and the specific compression library) to configure the data "operators" of the parallel I/O library.</p>
<p>The tool <code>adios2_to_nek5000</code> can be used to decompress the field data for postprocessing and visualization with the conventional nek5000 format. Additionally, the data can be compressed using this tool as a postprocessing step using the <code>adios2.xml</code> configuration and a given uncompressed data set as input. </p><div class="fragment"><div class="line">adios2_to_nek5000 input.bp/fld output.fld/bp .false. 1</div>
</div><!-- fragment --><p> The bool parameter specifies whether output is written using double precision. The parsed integer specifies the data layout in the case of an ADIOS2 <code>.bp</code> output file.</p>
<p>The tool <code>psnr</code> can be used to analyze the Peak-Signal-to-Noise Ratio (PSNR), quantifying the compression efficiency, namely, the relation between compression ratio and the lost accuracy due to lossy data compression. </p><div class="fragment"><div class="line">psnr compressed_fields.bp uncompressed_fields.fld/bp .false.</div>
</div><!-- fragment --><p> (The bool parameter specifies whether output should be double precision.) Test data sets can be generated during preprocessing and in an initial case setup workflow to compare and find an optimal compression rate with an acceptable accuracy loss. The value of the PSNR decreases with increasing accuracy loss. Tune the compression by increasing the compression ratio until a desired lower limiting value for the PSNR is reached. As a rule of thumb, target values of 60 or 40 can be used as lower limit for accurate postprocessing or visualization, respectively. Separately, it is recommended to check for compression errors from lossy compressors in the specific quantities of interest in postprocessing and visualization.</p>
<h1><a class="anchor" id="autotoc_md126"></a>
Checkpoint files</h1>
<p>Simulations cannot be restarted from <code>.fld</code> files (although you can use an <code>fld</code> to provide initial conditions). Instead, separate checkpoint files can be output for the purpose of restarts. These contain additional information allowing a clean restart, with, e.g., the correct time integration order. A separate file format, <code>.chkp</code> is adopted for the checkpoint files. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="../../index.html">Neko Manual</a></li><li class="navelem"><a class="el" href="../../dd/d04/user-guide.html">User guide</a></li>
    <li class="footer">Generated on Fri Dec 19 2025 03:50:40 for Neko by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Neko: Examples: Programming the user file</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../doxygen-awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Neko<span id="projectnumber">&#160;1.99.1</span>
   </div>
   <div id="projectbrief">A portable framework for high-order spectral element flow simulations</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('d5/db5/programming-examples.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Examples: Programming the user file</div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><ul><li class="level2"><a href="#autotoc_md161">&lt;tt&gt;user_file_template.f90&lt;/tt&gt;</a></li>
<li class="level2"><a href="#autotoc_md162">&lt;tt&gt;startup_and_json.f90&lt;/tt&gt;</a></li>
<li class="level2"><a href="#autotoc_md163">&lt;tt&gt;fields_vectors_math.f90&lt;/tt&gt;</a></li>
<li class="level2"><a href="#autotoc_md164">&lt;tt&gt;registries.f90&lt;/tt&gt;</a></li>
<li class="level2"><a href="#autotoc_md165">&lt;tt&gt;output.f90&lt;/tt&gt;</a></li>
<li class="level2"><a href="#autotoc_md166">&lt;tt&gt;custom_types.f90&lt;/tt&gt;</a></li>
</ul>
</ul>
</div>
<div class="textblock"><p>This directory contains tutorial files that demonstrate various aspects of programming with Neko. Each file provides examples and explanations for specific features, concepts, or workflows in Neko, helping users to customize and extend their simulations effectively.</p>
<p>The files don't necessarily need to be run, but executing <code>prepare.sh</code> will copy over a mesh and case file from the cylinder example, so you can use <code>makeneko</code> on a <code>.f90</code> and run it.</p>
<h2><a class="anchor" id="autotoc_md161"></a>
&lt;tt&gt;user_file_template.f90&lt;/tt&gt;</h2>
<p>A user file template with stubs for every possible user subroutine.</p>
<div class="fragment"><div class="line"><span class="comment">! A template user file containing the user-defined functions</span></div>
<div class="line"><span class="comment">!</span></div>
<div class="line"><span class="keyword">module</span> <a class="code hl_namespace" href="../../dc/d44/namespaceuser.html">user</a></div>
<div class="line">  <span class="keywordtype">use </span><a class="code hl_namespace" href="../../dd/d62/namespaceneko.html">neko</a></div>
<div class="line">  <span class="keywordtype">implicit none</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">contains</span></div>
<div class="line"> </div>
<div class="line">  <span class="comment">! Register user-defined functions (see user_intf.f90)</span></div>
<div class="line">  <span class="keyword">subroutine </span><a class="code hl_function" href="../../dc/d44/namespaceuser.html#a34728c151f0dbb7521a84b18b09cbd9d">user_setup</a>(user)</div>
<div class="line">    <span class="keywordtype">type</span>(user_t), <span class="keywordtype">intent(inout)</span> :: user</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_namespace" href="../../dc/d44/namespaceuser.html">user</a>%startup =&gt; <a class="code hl_function" href="../../dc/d44/namespaceuser.html#a96b5ab432049f8df75005b125ae570c9">startup</a></div>
<div class="line">    <a class="code hl_namespace" href="../../dc/d44/namespaceuser.html">user</a>%initialize =&gt; <a class="code hl_function" href="../../dc/d44/namespaceuser.html#a2fd9b995e523d56e60c506dcc796a7c1">initialize</a></div>
<div class="line">    <a class="code hl_namespace" href="../../dc/d44/namespaceuser.html">user</a>%initial_conditions =&gt; <a class="code hl_function" href="../../dc/d44/namespaceuser.html#a4862001a72d32d8417579a567293447f">initial_conditions</a></div>
<div class="line">    <a class="code hl_namespace" href="../../dc/d44/namespaceuser.html">user</a>%mesh_setup =&gt; <a class="code hl_function" href="../../dc/d44/namespaceuser.html#a1eddeb63328611862403607e997916b6">mesh_setup</a></div>
<div class="line">    <a class="code hl_namespace" href="../../dc/d44/namespaceuser.html">user</a>%compute =&gt; <a class="code hl_function" href="../../dc/d44/namespaceuser.html#a725b1b99599d26ff95cf2ac1cb400b08">compute</a></div>
<div class="line">    <a class="code hl_namespace" href="../../dc/d44/namespaceuser.html">user</a>%finalize =&gt; <a class="code hl_function" href="../../dc/d44/namespaceuser.html#add0bbc1561124367d2a98f64884f07ae">finalize</a></div>
<div class="line">    <a class="code hl_namespace" href="../../dc/d44/namespaceuser.html">user</a>%source_term =&gt; <a class="code hl_namespace" href="../../de/de7/namespacesource__term.html">source_term</a></div>
<div class="line">    <a class="code hl_namespace" href="../../dc/d44/namespaceuser.html">user</a>%dirichlet_conditions =&gt; <a class="code hl_function" href="../../dc/d44/namespaceuser.html#a7f78897c51d70f14e4bec6682839460a">dirichlet_conditions</a></div>
<div class="line">    <a class="code hl_namespace" href="../../dc/d44/namespaceuser.html">user</a>%material_properties =&gt; <a class="code hl_function" href="../../dc/d44/namespaceuser.html#a7a0eecae5ecbb72a981ea5c699fb5ec5">material_properties</a></div>
<div class="line"> </div>
<div class="line">  <span class="keyword">end subroutine </span><a class="code hl_function" href="../../dc/d44/namespaceuser.html#a34728c151f0dbb7521a84b18b09cbd9d">user_setup</a></div>
<div class="line"> </div>
<div class="line">  <span class="keyword">subroutine </span><a class="code hl_function" href="../../dc/d44/namespaceuser.html#a96b5ab432049f8df75005b125ae570c9">startup</a>(params)</div>
<div class="line">    <span class="keywordtype">type</span>(json_file), <span class="keywordtype">intent(inout)</span> :: params</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">end subroutine </span><a class="code hl_function" href="../../dc/d44/namespaceuser.html#a96b5ab432049f8df75005b125ae570c9">startup</a></div>
<div class="line"> </div>
<div class="line">  <span class="keyword">subroutine </span><a class="code hl_function" href="../../dc/d44/namespaceuser.html#a2fd9b995e523d56e60c506dcc796a7c1">initialize</a>(time)</div>
<div class="line">    <span class="keywordtype">type</span>(time_state_t), <span class="keywordtype">intent(in)</span> :: time</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">end subroutine </span><a class="code hl_function" href="../../dc/d44/namespaceuser.html#a2fd9b995e523d56e60c506dcc796a7c1">initialize</a></div>
<div class="line"> </div>
<div class="line">  <span class="keyword">subroutine </span><a class="code hl_function" href="../../dc/d44/namespaceuser.html#a4862001a72d32d8417579a567293447f">initial_conditions</a>(scheme_name, fields)</div>
<div class="line">    <span class="keywordtype">character(len=*)</span>, <span class="keywordtype">intent(in)</span> :: scheme_name</div>
<div class="line">    <span class="keywordtype">type</span>(field_list_t), <span class="keywordtype">intent(inout)</span> :: fields</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">end subroutine </span><a class="code hl_function" href="../../dc/d44/namespaceuser.html#a4862001a72d32d8417579a567293447f">initial_conditions</a></div>
<div class="line"> </div>
<div class="line">  <span class="keyword">subroutine </span><a class="code hl_function" href="../../dc/d44/namespaceuser.html#a1eddeb63328611862403607e997916b6">mesh_setup</a>(msh, time)</div>
<div class="line">    <span class="keywordtype">type</span>(mesh_t), <span class="keywordtype">intent(inout)</span> :: msh</div>
<div class="line">    <span class="keywordtype">type</span>(time_state_t), <span class="keywordtype">intent(in)</span> :: time</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">end subroutine </span><a class="code hl_function" href="../../dc/d44/namespaceuser.html#a1eddeb63328611862403607e997916b6">mesh_setup</a></div>
<div class="line"> </div>
<div class="line">  <span class="keyword">subroutine </span><a class="code hl_function" href="../../dc/d44/namespaceuser.html#a725b1b99599d26ff95cf2ac1cb400b08">compute</a>(time)</div>
<div class="line">    <span class="keywordtype">type</span>(time_state_t), <span class="keywordtype">intent(in)</span> :: time</div>
<div class="line">  <span class="keyword">end subroutine </span><a class="code hl_function" href="../../dc/d44/namespaceuser.html#a725b1b99599d26ff95cf2ac1cb400b08">compute</a></div>
<div class="line"> </div>
<div class="line">  <span class="keyword">subroutine </span><a class="code hl_function" href="../../dc/d44/namespaceuser.html#add0bbc1561124367d2a98f64884f07ae">finalize</a>(time)</div>
<div class="line">    <span class="keywordtype">type</span>(time_state_t), <span class="keywordtype">intent(in)</span> :: time</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">end subroutine </span><a class="code hl_function" href="../../dc/d44/namespaceuser.html#add0bbc1561124367d2a98f64884f07ae">finalize</a></div>
<div class="line"> </div>
<div class="line">  <span class="keyword">subroutine </span><a class="code hl_namespace" href="../../de/de7/namespacesource__term.html">source_term</a>(scheme_name, rhs, time)</div>
<div class="line">    <span class="keywordtype">character(len=*)</span>, <span class="keywordtype">intent(in)</span> :: scheme_name</div>
<div class="line">    <span class="keywordtype">type</span>(field_list_t), <span class="keywordtype">intent(inout)</span> :: rhs</div>
<div class="line">    <span class="keywordtype">type</span>(time_state_t), <span class="keywordtype">intent(in)</span> :: time</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">end subroutine </span><a class="code hl_namespace" href="../../de/de7/namespacesource__term.html">source_term</a></div>
<div class="line"> </div>
<div class="line">  <span class="keyword">subroutine </span><a class="code hl_function" href="../../dc/d44/namespaceuser.html#a7f78897c51d70f14e4bec6682839460a">dirichlet_conditions</a>(fields, bc, time)</div>
<div class="line">    <span class="keywordtype">type</span>(field_list_t), <span class="keywordtype">intent(inout)</span> :: fields</div>
<div class="line">    <span class="keywordtype">type</span>(field_dirichlet_t), <span class="keywordtype">intent(in)</span> :: bc</div>
<div class="line">    <span class="keywordtype">type</span>(time_state_t), <span class="keywordtype">intent(in)</span> :: time</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">end subroutine </span><a class="code hl_function" href="../../dc/d44/namespaceuser.html#a7f78897c51d70f14e4bec6682839460a">dirichlet_conditions</a></div>
<div class="line"> </div>
<div class="line">  <span class="keyword">subroutine </span><a class="code hl_function" href="../../dc/d44/namespaceuser.html#a7a0eecae5ecbb72a981ea5c699fb5ec5">material_properties</a>(scheme_name, properties, time)</div>
<div class="line">    <span class="keywordtype">character(len=*)</span>, <span class="keywordtype">intent(in)</span> :: scheme_name</div>
<div class="line">    <span class="keywordtype">type</span>(field_list_t), <span class="keywordtype">intent(inout)</span> :: properties</div>
<div class="line">    <span class="keywordtype">type</span>(time_state_t), <span class="keywordtype">intent(in)</span> :: time</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">end subroutine </span><a class="code hl_function" href="../../dc/d44/namespaceuser.html#a7a0eecae5ecbb72a981ea5c699fb5ec5">material_properties</a></div>
<div class="line"> </div>
<div class="line"><span class="keyword">end module </span><a class="code hl_namespace" href="../../dc/d44/namespaceuser.html">user</a></div>
<div class="ttc" id="anamespaceneko_html"><div class="ttname"><a href="../../dd/d62/namespaceneko.html">neko</a></div><div class="ttdoc">Master module.</div><div class="ttdef"><b>Definition</b> <a href="../../d5/d1f/neko_8f90_source.html#l00034">neko.f90:34</a></div></div>
<div class="ttc" id="anamespacesource__term_html"><div class="ttname"><a href="../../de/de7/namespacesource__term.html">source_term</a></div><div class="ttdoc">Implements the source_term_t type and a wrapper source_term_wrapper_t.</div><div class="ttdef"><b>Definition</b> <a href="../../df/d69/source__term_8f90_source.html#l00034">source_term.f90:34</a></div></div>
<div class="ttc" id="anamespaceuser_html"><div class="ttname"><a href="../../dc/d44/namespaceuser.html">user</a></div><div class="ttdef"><b>Definition</b> <a href="../../d3/d6f/fields__vectors__math_8f90_source.html#l00018">fields_vectors_math.f90:18</a></div></div>
<div class="ttc" id="anamespaceuser_html_a1eddeb63328611862403607e997916b6"><div class="ttname"><a href="../../dc/d44/namespaceuser.html#a1eddeb63328611862403607e997916b6">user::mesh_setup</a></div><div class="ttdeci">subroutine mesh_setup(msh, time)</div><div class="ttdef"><b>Definition</b> <a href="../../da/dcf/user__file__template_8f90_source.html#l00041">user_file_template.f90:42</a></div></div>
<div class="ttc" id="anamespaceuser_html_a2fd9b995e523d56e60c506dcc796a7c1"><div class="ttname"><a href="../../dc/d44/namespaceuser.html#a2fd9b995e523d56e60c506dcc796a7c1">user::initialize</a></div><div class="ttdeci">subroutine initialize(time)</div><div class="ttdef"><b>Definition</b> <a href="../../d3/d6f/fields__vectors__math_8f90_source.html#l00053">fields_vectors_math.f90:54</a></div></div>
<div class="ttc" id="anamespaceuser_html_a34728c151f0dbb7521a84b18b09cbd9d"><div class="ttname"><a href="../../dc/d44/namespaceuser.html#a34728c151f0dbb7521a84b18b09cbd9d">user::user_setup</a></div><div class="ttdeci">subroutine user_setup(user)</div><div class="ttdef"><b>Definition</b> <a href="../../d3/d6f/fields__vectors__math_8f90_source.html#l00034">fields_vectors_math.f90:35</a></div></div>
<div class="ttc" id="anamespaceuser_html_a4862001a72d32d8417579a567293447f"><div class="ttname"><a href="../../dc/d44/namespaceuser.html#a4862001a72d32d8417579a567293447f">user::initial_conditions</a></div><div class="ttdeci">subroutine initial_conditions(scheme_name, fields)</div><div class="ttdef"><b>Definition</b> <a href="../../da/dcf/user__file__template_8f90_source.html#l00035">user_file_template.f90:36</a></div></div>
<div class="ttc" id="anamespaceuser_html_a725b1b99599d26ff95cf2ac1cb400b08"><div class="ttname"><a href="../../dc/d44/namespaceuser.html#a725b1b99599d26ff95cf2ac1cb400b08">user::compute</a></div><div class="ttdeci">subroutine compute(time)</div><div class="ttdef"><b>Definition</b> <a href="../../d3/d6f/fields__vectors__math_8f90_source.html#l00084">fields_vectors_math.f90:85</a></div></div>
<div class="ttc" id="anamespaceuser_html_a7a0eecae5ecbb72a981ea5c699fb5ec5"><div class="ttname"><a href="../../dc/d44/namespaceuser.html#a7a0eecae5ecbb72a981ea5c699fb5ec5">user::material_properties</a></div><div class="ttdeci">subroutine material_properties(scheme_name, properties, time)</div><div class="ttdef"><b>Definition</b> <a href="../../da/dcf/user__file__template_8f90_source.html#l00070">user_file_template.f90:71</a></div></div>
<div class="ttc" id="anamespaceuser_html_a7f78897c51d70f14e4bec6682839460a"><div class="ttname"><a href="../../dc/d44/namespaceuser.html#a7f78897c51d70f14e4bec6682839460a">user::dirichlet_conditions</a></div><div class="ttdeci">subroutine dirichlet_conditions(fields, bc, time)</div><div class="ttdef"><b>Definition</b> <a href="../../da/dcf/user__file__template_8f90_source.html#l00063">user_file_template.f90:64</a></div></div>
<div class="ttc" id="anamespaceuser_html_a96b5ab432049f8df75005b125ae570c9"><div class="ttname"><a href="../../dc/d44/namespaceuser.html#a96b5ab432049f8df75005b125ae570c9">user::startup</a></div><div class="ttdeci">subroutine startup(params)</div><div class="ttdef"><b>Definition</b> <a href="../../d3/d6f/fields__vectors__math_8f90_source.html#l00044">fields_vectors_math.f90:45</a></div></div>
<div class="ttc" id="anamespaceuser_html_add0bbc1561124367d2a98f64884f07ae"><div class="ttname"><a href="../../dc/d44/namespaceuser.html#add0bbc1561124367d2a98f64884f07ae">user::finalize</a></div><div class="ttdeci">subroutine finalize(time)</div><div class="ttdef"><b>Definition</b> <a href="../../d3/d6f/fields__vectors__math_8f90_source.html#l00125">fields_vectors_math.f90:126</a></div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md162"></a>
&lt;tt&gt;startup_and_json.f90&lt;/tt&gt;</h2>
<p>Demonstrates how to define user-specific routines and interact with the JSON parameter dictionary used for simulation configuration.</p>
<div class="fragment"><div class="line"><span class="comment">! This module demonstrates how to define user-specific routines in Neko. It</span></div>
<div class="line"><span class="comment">! provides an example of how to interact with the JSON parameter dictionary</span></div>
<div class="line"><span class="comment">! used for simulation configuration. The key points covered in this tutorial</span></div>
<div class="line"><span class="comment">! are:</span></div>
<div class="line"><span class="comment">!</span></div>
<div class="line"><span class="comment">! - Registering user-defined functions using the `user_setup` routine.</span></div>
<div class="line"><span class="comment">! - Using the `user_startup` routine to inspect and manipulate the JSON</span></div>
<div class="line"><span class="comment">!   parameter dictionary before the simulation starts.</span></div>
<div class="line"><span class="comment">! - Extracting parameters from the JSON file using `json_get` and</span></div>
<div class="line"><span class="comment">!   `json_get_or_default`.</span></div>
<div class="line"><span class="comment">! - Printing JSON objects using the `print` method.</span></div>
<div class="line"><span class="comment">! - Adding or modifying parameters in the JSON file using the `add` method.</span></div>
<div class="line"><span class="comment">! - Saving the JSON parameter dictionary for later use in the module.</span></div>
<div class="line"><span class="comment">!</span></div>
<div class="line"><span class="comment">! This tutorial highlights the flexibility of the JSON-based configuration</span></div>
<div class="line"><span class="comment">! system in Neko and demonstrates how to customize simulations by interacting</span></div>
<div class="line"><span class="comment">! with the JSON parameter dictionary.</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="comment">! The user module always needs to be named &quot;user&quot;!</span></div>
<div class="line"><span class="keyword">module</span> <a class="code hl_namespace" href="../../dc/d44/namespaceuser.html">user</a></div>
<div class="line">  <span class="comment">! This use statement populates the scope of the module with all the types and</span></div>
<div class="line">  <span class="comment">! public procedures defined in Neko. So, this is convenient, but your scope</span></div>
<div class="line">  <span class="comment">! does get very polluted. It is generallys a good idea to `use` only the</span></div>
<div class="line">  <span class="comment">! modules you need, and moreover specify what exactly you want from those</span></div>
<div class="line">  <span class="comment">! modules using `use ..., only :`.</span></div>
<div class="line">  <span class="keywordtype">use </span><a class="code hl_namespace" href="../../dd/d62/namespaceneko.html">neko</a></div>
<div class="line">  <span class="keywordtype">implicit none</span></div>
<div class="line"> </div>
<div class="line">  <span class="comment">! A module-scope variable to hold a copy of the case file JSON parameter</span></div>
<div class="line">  <span class="comment">! dictionary.</span></div>
<div class="line">  <span class="keywordtype">type</span>(json_file) :: case_params</div>
<div class="line"> </div>
<div class="line">  <span class="comment">! Some variable that we want to use in the user code.</span></div>
<div class="line"><span class="keywordtype">  real</span>(kind=rp) :: <a class="code hl_variable" href="../../dc/d44/namespaceuser.html#a33f4028cbc0128b21d8fec50d386719b">some_variable</a></div>
<div class="line"> </div>
<div class="line"><span class="keyword">contains</span></div>
<div class="line"> </div>
<div class="line">  <span class="comment">! This is a special routine that registers the user-defined functions with</span></div>
<div class="line">  <span class="comment">! Neko. Based on the inerface defined in user_intf.f90, we can register our</span></div>
<div class="line">  <span class="comment">! user-defined implementations of the various routines. You do this by</span></div>
<div class="line">  <span class="comment">! assigning procedure pointers to subroutines in the user module. Here, we</span></div>
<div class="line">  <span class="comment">! register only the startup routine.</span></div>
<div class="line">  <span class="keyword">subroutine </span><a class="code hl_function" href="../../dc/d44/namespaceuser.html#a34728c151f0dbb7521a84b18b09cbd9d">user_setup</a>(user)</div>
<div class="line">    <span class="keywordtype">type</span>(user_t), <span class="keywordtype">intent(inout)</span> :: user</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_namespace" href="../../dc/d44/namespaceuser.html">user</a>%startup =&gt; <a class="code hl_function" href="../../dc/d44/namespaceuser.html#a96b5ab432049f8df75005b125ae570c9">startup</a></div>
<div class="line"> </div>
<div class="line">  <span class="keyword">end subroutine </span><a class="code hl_function" href="../../dc/d44/namespaceuser.html#a34728c151f0dbb7521a84b18b09cbd9d">user_setup</a></div>
<div class="line"> </div>
<div class="line">  <span class="comment">! The startup routine, provides the possibility to inspect and manipulate</span></div>
<div class="line">  <span class="comment">! the JSON parameter dictionary before the simulation starts. The routine is</span></div>
<div class="line">  <span class="comment">! called very early, before any of the solvers or simulation components are</span></div>
<div class="line">  <span class="comment">! initialized. This is also a good place to set up some constants that are</span></div>
<div class="line">  <span class="comment">! needed in the user code.</span></div>
<div class="line">  <span class="keyword">subroutine </span><a class="code hl_function" href="../../dc/d44/namespaceuser.html#a96b5ab432049f8df75005b125ae570c9">startup</a>(params)</div>
<div class="line">    <span class="keywordtype">type</span>(json_file), <span class="keywordtype">intent(inout)</span> :: params</div>
<div class="line"> </div>
<div class="line">    <span class="comment">! Some auxillary variables to extract various type of parameters from the</span></div>
<div class="line">    <span class="comment">! JSON</span></div>
<div class="line"><span class="keywordtype">    real</span>(kind=rp) :: some_real</div>
<div class="line">    <span class="comment">! Note that we need an allocatable when we extract strings or arrays.</span></div>
<div class="line">    <span class="comment">! The json_fortran library will allocate the string or array for us.</span></div>
<div class="line">    <span class="keywordtype">character(len=:)</span>, <span class="keywordtype">allocatable</span> :: some_string</div>
<div class="line"><span class="keywordtype">    real</span>(kind=rp), <span class="keywordtype">allocatable</span> :: some_real_array(:)</div>
<div class="line">    <span class="comment">! We can extract an entire JSON object into a new json_file.</span></div>
<div class="line">    <span class="keywordtype">type</span>(json_file) :: some_json_object</div>
<div class="line"> </div>
<div class="line">    <span class="comment">! Assign our constant to something. Can be based on JSON parameters</span></div>
<div class="line">    <span class="comment">! extracted below. A common use case is to set material properties based</span></div>
<div class="line">    <span class="comment">! on custom JSON entries in the case file, e.g. some non-dimensional number.</span></div>
<div class="line">    <a class="code hl_variable" href="../../dc/d44/namespaceuser.html#a33f4028cbc0128b21d8fec50d386719b">some_variable</a> = 1.0_rp</div>
<div class="line"> </div>
<div class="line">    <span class="comment">! Neko relies on json_fortran to parse and manipulate the JSON file.</span></div>
<div class="line">    <span class="comment">! In addition, there are some convenience subroutines in the json_utils</span></div>
<div class="line">    <span class="comment">! module.</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">! Extract a string parameter. This will through an error if</span></div>
<div class="line">    <span class="comment">! case.fluid.scheme does not exist in the JSON file.</span></div>
<div class="line">    <span class="keyword">call </span>json_get(params, <span class="stringliteral">&quot;case.fluid.scheme&quot;</span>, some_string)</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="comment">! Extract a real parameter, providing a default if it does not exist.</span></div>
<div class="line">    <span class="keyword">call </span>json_get_or_default(params, <span class="stringliteral">&quot;case.fluid.Re&quot;</span>, some_real, 100.0_rp)</div>
<div class="line"> </div>
<div class="line">    <span class="comment">! Extract the object with the velocity initial conditions.</span></div>
<div class="line">    <span class="keyword">call </span>json_get(params, <span class="stringliteral">&quot;case.fluid.initial_condition&quot;</span>, &amp;</div>
<div class="line">         some_json_object)</div>
<div class="line"> </div>
<div class="line">    <span class="comment">! We can print the contents to the console.</span></div>
<div class="line">    <span class="keyword">call </span>some_json_object%print()</div>
<div class="line"> </div>
<div class="line">    <span class="comment">! We can use the json_fotran methods to manipulate the JSON.</span></div>
<div class="line">    <span class="comment">! Here we add an additional parameter.</span></div>
<div class="line">    <span class="keyword">call </span>params%add(<span class="stringliteral">&quot;case.fluid.initial_condition.my_param&quot;</span>, 3.0_rp)</div>
<div class="line"> </div>
<div class="line">    <span class="comment">! Add can also be used to modify existing parameters.</span></div>
<div class="line">    some_real_array = [1.0_rp, 2.0_rp, 3.0_rp]</div>
<div class="line">    <span class="keyword">call </span>params%add(<span class="stringliteral">&quot;case.fluid.initial_condition.value&quot;</span>, some_real_array)</div>
<div class="line">    <span class="keyword">call </span>params%add(<span class="stringliteral">&quot;case.end_time&quot;</span>, 0.0_rp)</div>
<div class="line"> </div>
<div class="line">    <span class="comment">! Show the updated part of the JSON file.</span></div>
<div class="line">    <span class="keyword">call </span>json_get(params, <span class="stringliteral">&quot;case.fluid.initial_condition&quot;</span>, &amp;</div>
<div class="line">         some_json_object)</div>
<div class="line">    <span class="keyword">call </span>some_json_object%print()</div>
<div class="line"> </div>
<div class="line">    <span class="comment">! There are a few other json utilities in neko, as well as more methods in</span></div>
<div class="line">    <span class="comment">! the json_fortran library. So, you can pretty much do anything you want</span></div>
<div class="line">    <span class="comment">! with the case file, if you so need.</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">! We can save the params into our module-scope variable for later use.</span></div>
<div class="line">    case_params = params</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">end subroutine </span><a class="code hl_function" href="../../dc/d44/namespaceuser.html#a96b5ab432049f8df75005b125ae570c9">startup</a></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">end module </span><a class="code hl_namespace" href="../../dc/d44/namespaceuser.html">user</a></div>
<div class="ttc" id="anamespaceuser_html_a33f4028cbc0128b21d8fec50d386719b"><div class="ttname"><a href="../../dc/d44/namespaceuser.html#a33f4028cbc0128b21d8fec50d386719b">user::some_variable</a></div><div class="ttdeci">real(kind=rp) some_variable</div><div class="ttdef"><b>Definition</b> <a href="../../d2/d90/startup__and__json_8f90_source.html#l00035">startup_and_json.f90:35</a></div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md163"></a>
&lt;tt&gt;fields_vectors_math.f90&lt;/tt&gt;</h2>
<p>Explains how to work with the <code>field_t</code> and <code>vector_t</code> types in Neko, including mathematical operations and lifecycle management.</p>
<div class="fragment"><div class="line"><span class="comment">! This tutorial demonstrates how to work with fields and vectors in Neko. It</span></div>
<div class="line"><span class="comment">! covers the following key points:</span></div>
<div class="line"><span class="comment">!</span></div>
<div class="line"><span class="comment">! - Initializing and working with `field_t` and `vector_t` types.</span></div>
<div class="line"><span class="comment">! - Performing mathematical operations on fields and vectors, including:</span></div>
<div class="line"><span class="comment">!   - Using overloaded operators for basic operations.</span></div>
<div class="line"><span class="comment">!   - Accessing and modifying field data directly on the CPU.</span></div>
<div class="line"><span class="comment">!   - Using low-level math routines for device and CPU compatibility.</span></div>
<div class="line"><span class="comment">!   - Leveraging the `field_math` module for backend-agnostic computations.</span></div>
<div class="line"><span class="comment">! - Demonstrating the lifecycle of user-defined objects:</span></div>
<div class="line"><span class="comment">!   - Initializing fields and vectors in `user_init_modules`.</span></div>
<div class="line"><span class="comment">!   - Performing custom calculations in `user_check`.</span></div>
<div class="line"><span class="comment">!   - Cleaning up allocated resources in `user_finalize_modules`.</span></div>
<div class="line"><span class="comment">!</span></div>
<div class="line"><span class="comment">! This tutorial highlights the flexibility of Neko&#39;s field and vector types,</span></div>
<div class="line"><span class="comment">! as well as the tools provided for efficient and portable numerical</span></div>
<div class="line"><span class="comment">! computations across different backends.</span></div>
<div class="line"><span class="keyword">module</span> <a class="code hl_namespace" href="../../dc/d44/namespaceuser.html">user</a></div>
<div class="line">  <span class="keywordtype">use </span><a class="code hl_namespace" href="../../dd/d62/namespaceneko.html">neko</a></div>
<div class="line">  <span class="keywordtype">implicit none</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="comment">! One of the most important types in Neko is the field_t type. It is used to</span></div>
<div class="line">  <span class="comment">! represent the solution fields in the simulation.</span></div>
<div class="line">  <span class="keywordtype">type</span>(field_t) :: my_field</div>
<div class="line"> </div>
<div class="line">  <span class="comment">! A vector is essentially a 1D array that handles the storage and association</span></div>
<div class="line">  <span class="comment">! between data on the host and the device.</span></div>
<div class="line">  <span class="keywordtype">type</span>(vector_t) :: vec</div>
<div class="line"> </div>
<div class="line"><span class="keyword">contains</span></div>
<div class="line"> </div>
<div class="line">  <span class="comment">! Register user-defined functions (see user_intf.f90)</span></div>
<div class="line">  <span class="keyword">subroutine </span><a class="code hl_function" href="../../dc/d44/namespaceuser.html#a34728c151f0dbb7521a84b18b09cbd9d">user_setup</a>(user)</div>
<div class="line">    <span class="keywordtype">type</span>(user_t), <span class="keywordtype">intent(inout)</span> :: user</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_namespace" href="../../dc/d44/namespaceuser.html">user</a>%startup =&gt; <a class="code hl_function" href="../../dc/d44/namespaceuser.html#a96b5ab432049f8df75005b125ae570c9">startup</a></div>
<div class="line">    <a class="code hl_namespace" href="../../dc/d44/namespaceuser.html">user</a>%initialize =&gt; <a class="code hl_function" href="../../dc/d44/namespaceuser.html#a2fd9b995e523d56e60c506dcc796a7c1">initialize</a></div>
<div class="line">    <a class="code hl_namespace" href="../../dc/d44/namespaceuser.html">user</a>%compute =&gt; <a class="code hl_function" href="../../dc/d44/namespaceuser.html#a725b1b99599d26ff95cf2ac1cb400b08">compute</a></div>
<div class="line">    <a class="code hl_namespace" href="../../dc/d44/namespaceuser.html">user</a>%finalize =&gt; <a class="code hl_function" href="../../dc/d44/namespaceuser.html#add0bbc1561124367d2a98f64884f07ae">finalize</a></div>
<div class="line">  <span class="keyword">end subroutine </span><a class="code hl_function" href="../../dc/d44/namespaceuser.html#a34728c151f0dbb7521a84b18b09cbd9d">user_setup</a></div>
<div class="line"> </div>
<div class="line">  <span class="comment">! We will use the user_startup routine to manipulate the end time.</span></div>
<div class="line">  <span class="keyword">subroutine </span><a class="code hl_function" href="../../dc/d44/namespaceuser.html#a96b5ab432049f8df75005b125ae570c9">startup</a>(params)</div>
<div class="line">    <span class="keywordtype">type</span>(json_file), <span class="keywordtype">intent(inout)</span> :: params</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">call </span>params%add(<span class="stringliteral">&quot;case.end_time&quot;</span>, 0.0_rp)</div>
<div class="line">  <span class="keyword">end subroutine </span><a class="code hl_function" href="../../dc/d44/namespaceuser.html#a96b5ab432049f8df75005b125ae570c9">startup</a></div>
<div class="line"> </div>
<div class="line">  <span class="comment">! The user_init_modules routine is called after all the objects used to run</span></div>
<div class="line">  <span class="comment">! the simulation are created. Thus, we can initialize user variables that,</span></div>
<div class="line">  <span class="comment">! for example, depend on the mesh or the fluid solver.</span></div>
<div class="line">  <span class="keyword">subroutine </span><a class="code hl_function" href="../../dc/d44/namespaceuser.html#a2fd9b995e523d56e60c506dcc796a7c1">initialize</a>(time)</div>
<div class="line">    <span class="keywordtype">type</span>(time_state_t), <span class="keywordtype">intent(in)</span> :: time</div>
<div class="line"> </div>
<div class="line">    <span class="comment">! Like almost all other Neko types, the field_t has an init method that is</span></div>
<div class="line">    <span class="comment">! effectively a constructor. Typically, we use a dofmap_t object and a</span></div>
<div class="line">    <span class="comment">! a name to call the init method. The dofmap_t is usually fetched from the</span></div>
<div class="line">    <span class="comment">! solver, like a `fluid_scheme_t`. To do this, we make use of the special</span></div>
<div class="line">    <span class="comment">! neko_user_access object, which is a singleton that provides access to</span></div>
<div class="line">    <span class="comment">! various objects used in the simulation.</span></div>
<div class="line">    <span class="keyword">call </span>my_field%init(neko_user_access%case%fluid%dm_Xh, <span class="stringliteral">&quot;my_field&quot;</span>)</div>
<div class="line"> </div>
<div class="line">    <span class="comment">! The actual values of the field are stored in the x array or the x_d</span></div>
<div class="line">    <span class="comment">! pointer. The x_d pointer is used to access the data on the GPU. The x</span></div>
<div class="line">    <span class="comment">! array has a rank of 4, corresponding to GLL points in 3 dimensions, and</span></div>
<div class="line">    <span class="comment">! the number of elements in the mesh (i,j,k,e).</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">! Some operators are overloaded for the field_t type. For example, we can</span></div>
<div class="line">    <span class="comment">! assign it to a scalar. At construction, the values are set to zero.</span></div>
<div class="line">    my_field = 1.0_rp</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="comment">! The situation for vector is similar, but we only need to provide the size</span></div>
<div class="line">    <span class="comment">! of the array we want in the constructor.</span></div>
<div class="line">    <span class="keyword">call </span>vec%init(50)</div>
<div class="line"> </div>
<div class="line">    vec = 1.0_rp</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">end subroutine </span><a class="code hl_function" href="../../dc/d44/namespaceuser.html#a2fd9b995e523d56e60c506dcc796a7c1">initialize</a></div>
<div class="line"> </div>
<div class="line">  <span class="comment">! This routine is run at the end of each time step. It is mean to hold</span></div>
<div class="line">  <span class="comment">! arbitrary calculations that the user wants to do.</span></div>
<div class="line">  <span class="keyword">subroutine </span><a class="code hl_function" href="../../dc/d44/namespaceuser.html#a725b1b99599d26ff95cf2ac1cb400b08">compute</a>(time)</div>
<div class="line">    <span class="keywordtype">type</span>(time_state_t), <span class="keywordtype">intent(in)</span> :: time</div>
<div class="line">    <span class="keywordtype">integer</span> :: i</div>
<div class="line"> </div>
<div class="line">    <span class="comment">! Let us consider doing some simple math on our field. Here we just add 1</span></div>
<div class="line">    <span class="comment">! to the value at each GLL point. Note that we use a linear index to loop</span></div>
<div class="line">    <span class="comment">! over the entire field, and use %x(i,1,1,1). This is very common in Neko,</span></div>
<div class="line">    <span class="comment">! and relies on contiguous memory layout. Sometimes you will see 4D arrays</span></div>
<div class="line">    <span class="comment">! passed to dummy arguments that are 1D, 2D, etc. This is possible for the</span></div>
<div class="line">    <span class="comment">! same reason.</span></div>
<div class="line">    <span class="keywordflow">do</span> i = 1, my_field%size() <span class="comment">! &lt;- Number of GLL points.</span></div>
<div class="line">       my_field%x(i,1,1,1) = my_field%x(i,1,1,1) * 2.0_rp</div>
<div class="line"><span class="keywordflow">    end do</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">! There is an issue with the above code: it only works on the CPU. You can</span></div>
<div class="line">    <span class="comment">! not write GPU kernels as a user. Therefore, Neko has a whole range of</span></div>
<div class="line">    <span class="comment">! low-level math functions that can be used. You can find them in math.f90.</span></div>
<div class="line">    <span class="comment">! Corresponding routines for the GPU are in device_math.f90, and</span></div>
<div class="line">    <span class="comment">! field_math.f90 contains wrappers that dispatch correctly to either a CPU</span></div>
<div class="line">    <span class="comment">! or device routine based on the current backend. The names of the routines</span></div>
<div class="line">    <span class="comment">! are taken from Nek5000, so if you are familiar with that code, you will</span></div>
<div class="line">    <span class="comment">! find it easy to use.</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">! A generic way to perform the computation above would be</span></div>
<div class="line">    <span class="keywordflow">if</span> (neko_bcknd_device .eq. 1) <span class="keywordflow">then</span> <span class="comment">! &lt;- Check if we are on the device.</span></div>
<div class="line">       <span class="keyword">call </span>device_cmult(my_field%x_d, 2.0_rp, my_field%size())</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">       <span class="keyword">call </span>cmult(my_field%x, 2.0_rp, my_field%size())</div>
<div class="line"><span class="keywordflow">    end if</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">! Alternatively, (and more concisely) we can use the field_math module,</span></div>
<div class="line">    <span class="keyword">call </span>field_cmult(my_field, 2.0_rp)</div>
<div class="line"> </div>
<div class="line">    <span class="comment">! For vector_t there are no math wrappers, so the latter approach is the</span></div>
<div class="line">    <span class="comment">! one to go for. The vector_t does overload some operators though, so use</span></div>
<div class="line">    <span class="comment">! those when possible.</span></div>
<div class="line"> </div>
<div class="line">  <span class="keyword">end subroutine </span><a class="code hl_function" href="../../dc/d44/namespaceuser.html#a725b1b99599d26ff95cf2ac1cb400b08">compute</a></div>
<div class="line"> </div>
<div class="line">  <span class="comment">! If you declare objects at module scope that need to be destroyed, you can</span></div>
<div class="line">  <span class="comment">! do it here. In our case it is the my_field field.</span></div>
<div class="line">  <span class="keyword">subroutine </span><a class="code hl_function" href="../../dc/d44/namespaceuser.html#add0bbc1561124367d2a98f64884f07ae">finalize</a>(time)</div>
<div class="line">    <span class="keywordtype">type</span>(time_state_t), <span class="keywordtype">intent(in)</span> :: time</div>
<div class="line"> </div>
<div class="line">    <span class="comment">! All types the allocate memory in Neko have a free method, which is a</span></div>
<div class="line">    <span class="comment">! destructor.</span></div>
<div class="line">    <span class="keyword">call </span>my_field%free()</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">end subroutine </span><a class="code hl_function" href="../../dc/d44/namespaceuser.html#add0bbc1561124367d2a98f64884f07ae">finalize</a></div>
<div class="line"> </div>
<div class="line"><span class="keyword">end module </span><a class="code hl_namespace" href="../../dc/d44/namespaceuser.html">user</a></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md164"></a>
&lt;tt&gt;registries.f90&lt;/tt&gt;</h2>
<p>Shows how to use registries in Neko to manage fields and temporary data efficiently.</p>
<div class="fragment"><div class="line"><span class="comment">! This tutorial demonstrates how to use registries in Neko to manage fields and</span></div>
<div class="line"><span class="comment">! temporary data. It covers the following key points:</span></div>
<div class="line"><span class="comment">!</span></div>
<div class="line"><span class="comment">! - Registering user-defined routines using the `user_setup` subroutine.</span></div>
<div class="line"><span class="comment">! - Accessing and managing fields using the `neko_field_registry`:</span></div>
<div class="line"><span class="comment">!   - Retrieving existing fields registered by solvers (e.g., velocity fields).</span></div>
<div class="line"><span class="comment">!   - Registering new fields for use across modules or for output purposes.</span></div>
<div class="line"><span class="comment">! - Using the `neko_scratch_registry` to manage temporary fields:</span></div>
<div class="line"><span class="comment">!   - Requesting temporary fields for intermediate calculations.</span></div>
<div class="line"><span class="comment">!   - Reliquishing temporary fields to free resources.</span></div>
<div class="line"><span class="comment">!</span></div>
<div class="line"><span class="keyword">module</span> <a class="code hl_namespace" href="../../dc/d44/namespaceuser.html">user</a></div>
<div class="line">  <span class="keywordtype">use </span><a class="code hl_namespace" href="../../dd/d62/namespaceneko.html">neko</a></div>
<div class="line">  <span class="keywordtype">implicit none</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">contains</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="comment">! Register user-defined functions (see user_intf.f90)</span></div>
<div class="line">  <span class="keyword">subroutine </span><a class="code hl_function" href="../../dc/d44/namespaceuser.html#a34728c151f0dbb7521a84b18b09cbd9d">user_setup</a>(user)</div>
<div class="line">    <span class="keywordtype">type</span>(user_t), <span class="keywordtype">intent(inout)</span> :: user</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_namespace" href="../../dc/d44/namespaceuser.html">user</a>%startup =&gt; <a class="code hl_function" href="../../dc/d44/namespaceuser.html#a96b5ab432049f8df75005b125ae570c9">startup</a></div>
<div class="line">    <a class="code hl_namespace" href="../../dc/d44/namespaceuser.html">user</a>%initialize =&gt; <a class="code hl_function" href="../../dc/d44/namespaceuser.html#a2fd9b995e523d56e60c506dcc796a7c1">initialize</a></div>
<div class="line">    <a class="code hl_namespace" href="../../dc/d44/namespaceuser.html">user</a>%compute =&gt; <a class="code hl_function" href="../../dc/d44/namespaceuser.html#a725b1b99599d26ff95cf2ac1cb400b08">compute</a></div>
<div class="line"> </div>
<div class="line">  <span class="keyword">end subroutine </span><a class="code hl_function" href="../../dc/d44/namespaceuser.html#a34728c151f0dbb7521a84b18b09cbd9d">user_setup</a></div>
<div class="line"> </div>
<div class="line">  <span class="comment">! We will use the startup routine to manipulate the end time.</span></div>
<div class="line">  <span class="keyword">subroutine </span><a class="code hl_function" href="../../dc/d44/namespaceuser.html#a96b5ab432049f8df75005b125ae570c9">startup</a>(params)</div>
<div class="line">    <span class="keywordtype">type</span>(json_file), <span class="keywordtype">intent(inout)</span> :: params</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">call </span>params%add(<span class="stringliteral">&quot;case.end_time&quot;</span>, 0.0_rp)</div>
<div class="line">  <span class="keyword">end subroutine </span><a class="code hl_function" href="../../dc/d44/namespaceuser.html#a96b5ab432049f8df75005b125ae570c9">startup</a></div>
<div class="line"> </div>
<div class="line">  <span class="keyword">subroutine </span><a class="code hl_function" href="../../dc/d44/namespaceuser.html#a2fd9b995e523d56e60c506dcc796a7c1">initialize</a>(time)</div>
<div class="line">    <span class="keywordtype">type</span>(time_state_t), <span class="keywordtype">intent(in)</span> :: time</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">type</span>(field_t), <span class="keywordtype">pointer</span> :: my_field_ptr</div>
<div class="line"> </div>
<div class="line">    <span class="comment">! Sometimes we need fields to be accessible across different modules. This</span></div>
<div class="line">    <span class="comment">! can include fields that we create in the user module. To that end, Neko</span></div>
<div class="line">    <span class="comment">! provides a special singleton object of type `field_registry_t`. The name</span></div>
<div class="line">    <span class="comment">! of the singleton is `neko_field_registry`. Solvers register their solution</span></div>
<div class="line">    <span class="comment">! fields there, for example.</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">! Here we can grab the x-velocity from the fluid_scheme_t, which is</span></div>
<div class="line">    <span class="comment">! registered as &quot;u&quot; in the registry.</span></div>
<div class="line">    my_field_ptr =&gt; neko_field_registry%get_field(<span class="stringliteral">&quot;u&quot;</span>)</div>
<div class="line"> </div>
<div class="line">    <span class="comment">! We can also register new fields. For that we need a dofmap_t object, just</span></div>
<div class="line">    <span class="comment">! like when we initialize a field. Once in the registry, the field is</span></div>
<div class="line">    <span class="comment">! available for access and manipulation in other modules.</span></div>
<div class="line">    <span class="comment">! Practical example: you may want to run some calculations on this field and</span></div>
<div class="line">    <span class="comment">! then use the field_writer simcomp to output it to disk during the</span></div>
<div class="line">    <span class="comment">! simulation. The field_writer looks for fields in the registry, given their</span></div>
<div class="line">    <span class="comment">! names.</span></div>
<div class="line">    <span class="keyword">call </span>neko_field_registry%add_field(my_field_ptr%dof, <span class="stringliteral">&quot;my_field&quot;</span>)</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">end subroutine </span><a class="code hl_function" href="../../dc/d44/namespaceuser.html#a2fd9b995e523d56e60c506dcc796a7c1">initialize</a></div>
<div class="line"> </div>
<div class="line">  <span class="keyword">subroutine </span><a class="code hl_function" href="../../dc/d44/namespaceuser.html#a725b1b99599d26ff95cf2ac1cb400b08">compute</a>(time)</div>
<div class="line">    <span class="keywordtype">type</span>(time_state_t), <span class="keywordtype">intent(in)</span> :: time</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">integer</span> :: temp_index</div>
<div class="line">    <span class="keywordtype">type</span>(field_t), <span class="keywordtype">pointer</span> :: temp_field_ptr</div>
<div class="line">    <span class="keywordtype">type</span>(field_t), <span class="keywordtype">pointer</span> :: u, v</div>
<div class="line"> </div>
<div class="line">    <span class="comment">! Sometimes we need some temporary fields to perform certain calculations.</span></div>
<div class="line">    <span class="comment">! Instead of declaring them inside a subroutine, Neko provides yet another</span></div>
<div class="line">    <span class="comment">! singleton: `neko_scratch_registry`, of type `scratch_registry_t`. The</span></div>
<div class="line">    <span class="comment">! advantage of using it is saving memory and time to allocate things.</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">! We get a temporary by using a field_t pointer and an index.</span></div>
<div class="line">    <span class="keyword">call </span>neko_scratch_registry%request_field(temp_field_ptr, temp_index)</div>
<div class="line"> </div>
<div class="line">    u =&gt; neko_field_registry%get_field(<span class="stringliteral">&quot;u&quot;</span>)</div>
<div class="line">    v =&gt; neko_field_registry%get_field(<span class="stringliteral">&quot;v&quot;</span>)</div>
<div class="line"> </div>
<div class="line">    <span class="comment">! Perform some operations and use the temporary for something</span></div>
<div class="line">    <span class="keyword">call </span>field_cfill(temp_field_ptr, 1.0_rp)</div>
<div class="line">    <span class="keyword">call </span>field_add2(temp_field_ptr, u)</div>
<div class="line">    v = temp_field_ptr</div>
<div class="line"> </div>
<div class="line">    <span class="comment">! At the end of the subroutine, the temporary field needs to be reliquished.</span></div>
<div class="line">    <span class="comment">! This is where the integer index comes in.</span></div>
<div class="line">    <span class="keyword">call </span>neko_scratch_registry%relinquish_field(temp_index)</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">end subroutine </span><a class="code hl_function" href="../../dc/d44/namespaceuser.html#a725b1b99599d26ff95cf2ac1cb400b08">compute</a></div>
<div class="line"> </div>
<div class="line"><span class="keyword">end module </span><a class="code hl_namespace" href="../../dc/d44/namespaceuser.html">user</a></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md165"></a>
&lt;tt&gt;output.f90&lt;/tt&gt;</h2>
<p>Shows how to output simulation data to .fld and .csv files.</p>
<div class="fragment"><div class="line"><span class="comment">! This tutorial demonstrates how to output simulation data to .fld and .csv</span></div>
<div class="line"><span class="comment">! files in Neko. It covers:</span></div>
<div class="line"><span class="comment">!</span></div>
<div class="line"><span class="comment">! - Writing single fields and lists of fields to .fld files using `fld_file_t`.</span></div>
<div class="line"><span class="comment">! - Controlling output precision for .fld files.</span></div>
<div class="line"><span class="comment">! - Writing data to .csv files using `csv_file_t` and `vector_t`.</span></div>
<div class="line"><span class="comment">! - Managing output across simulation steps and cleaning up resources.</span></div>
<div class="line"><span class="keyword">module</span> <a class="code hl_namespace" href="../../dc/d44/namespaceuser.html">user</a></div>
<div class="line">  <span class="keywordtype">use </span><a class="code hl_namespace" href="../../dd/d62/namespaceneko.html">neko</a></div>
<div class="line">  <span class="keywordtype">implicit none</span></div>
<div class="line"> </div>
<div class="line">  <span class="comment">! Custom fields we will output. We add the target attribute to make sure we</span></div>
<div class="line">  <span class="comment">! can point to them.</span></div>
<div class="line">  <span class="keywordtype">type</span>(field_t), <span class="keywordtype">target</span> :: my_field1</div>
<div class="line">  <span class="keywordtype">type</span>(field_t), <span class="keywordtype">target</span> :: my_field2</div>
<div class="line"> </div>
<div class="line">  <span class="comment">! A custom vector for CSV output</span></div>
<div class="line">  <span class="keywordtype">type</span>(vector_t) :: vec</div>
<div class="line"> </div>
<div class="line"><span class="keyword">contains</span></div>
<div class="line"> </div>
<div class="line">  <span class="comment">! Register user-defined functions (see user_intf.f90)</span></div>
<div class="line">  <span class="keyword">subroutine </span><a class="code hl_function" href="../../dc/d44/namespaceuser.html#a34728c151f0dbb7521a84b18b09cbd9d">user_setup</a>(user)</div>
<div class="line">    <span class="keywordtype">type</span>(user_t), <span class="keywordtype">intent(inout)</span> :: user</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_namespace" href="../../dc/d44/namespaceuser.html">user</a>%startup =&gt; <a class="code hl_function" href="../../dc/d44/namespaceuser.html#a96b5ab432049f8df75005b125ae570c9">startup</a></div>
<div class="line">    <a class="code hl_namespace" href="../../dc/d44/namespaceuser.html">user</a>%initialize =&gt; <a class="code hl_function" href="../../dc/d44/namespaceuser.html#a2fd9b995e523d56e60c506dcc796a7c1">initialize</a></div>
<div class="line">    <a class="code hl_namespace" href="../../dc/d44/namespaceuser.html">user</a>%finalize =&gt; <a class="code hl_function" href="../../dc/d44/namespaceuser.html#add0bbc1561124367d2a98f64884f07ae">finalize</a></div>
<div class="line"> </div>
<div class="line">  <span class="keyword">end subroutine </span><a class="code hl_function" href="../../dc/d44/namespaceuser.html#a34728c151f0dbb7521a84b18b09cbd9d">user_setup</a></div>
<div class="line"> </div>
<div class="line">  <span class="comment">! We will use the startup routine to manipulate the end time.</span></div>
<div class="line">  <span class="keyword">subroutine </span><a class="code hl_function" href="../../dc/d44/namespaceuser.html#a96b5ab432049f8df75005b125ae570c9">startup</a>(params)</div>
<div class="line">    <span class="keywordtype">type</span>(json_file), <span class="keywordtype">intent(inout)</span> :: params</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">call </span>params%add(<span class="stringliteral">&quot;case.end_time&quot;</span>, 0.0_rp)</div>
<div class="line">  <span class="keyword">end subroutine </span><a class="code hl_function" href="../../dc/d44/namespaceuser.html#a96b5ab432049f8df75005b125ae570c9">startup</a></div>
<div class="line"> </div>
<div class="line">  <span class="keyword">subroutine </span><a class="code hl_function" href="../../dc/d44/namespaceuser.html#a2fd9b995e523d56e60c506dcc796a7c1">initialize</a>(time)</div>
<div class="line">    <span class="keywordtype">type</span>(time_state_t), <span class="keywordtype">intent(in)</span> :: time</div>
<div class="line"> </div>
<div class="line">    <span class="comment">! A writer for .fld files</span></div>
<div class="line">    <span class="keywordtype">type</span>(fld_file_t) :: fld_writer</div>
<div class="line">    <span class="comment">! Storage for a list of fields, two in our case</span></div>
<div class="line">    <span class="keywordtype">type</span>(field_list_t) :: field_pair</div>
<div class="line">    <span class="comment">! A writer for CSV files</span></div>
<div class="line">    <span class="keywordtype">type</span>(csv_file_t) :: csv_writer</div>
<div class="line"> </div>
<div class="line">    <span class="comment">!</span></div>
<div class="line">    <span class="comment">! WRITING FLD FILES</span></div>
<div class="line">    <span class="comment">!</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">! Initialize the fields and set the values to 1.0 and 2.0</span></div>
<div class="line">    <span class="keyword">call </span>my_field1%init(neko_user_access%case%fluid%dm_Xh, <span class="stringliteral">&quot;my_field1&quot;</span>)</div>
<div class="line">    <span class="keyword">call </span>my_field2%init(neko_user_access%case%fluid%dm_Xh, <span class="stringliteral">&quot;my_field2&quot;</span>)</div>
<div class="line">    <span class="keyword">call </span>field_cfill(my_field1, 1.0_rp)</div>
<div class="line">    <span class="keyword">call </span>field_cfill(my_field2, 2.0_rp)</div>
<div class="line"> </div>
<div class="line">    <span class="comment">! Initialize the writer using the filename</span></div>
<div class="line">    <span class="keyword">call </span>fld_writer%init(<span class="stringliteral">&quot;my_output.fld&quot;</span>)</div>
<div class="line"> </div>
<div class="line">    <span class="comment">! Here is how we can output a single field to the fld file.</span></div>
<div class="line">    <span class="comment">! The field is written as the pressure field.</span></div>
<div class="line">    <span class="keyword">call </span>fld_writer%write(my_field1)</div>
<div class="line"> </div>
<div class="line">    <span class="comment">! We can also pack more fields inside a single file. To that end we need to</span></div>
<div class="line">    <span class="comment">! pass a field_list_t object to the writer. The field_list_t is a list of</span></div>
<div class="line">    <span class="comment">! field pointers.</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">! Initialize the field_list_t object with the number of fields we want to</span></div>
<div class="line">    <span class="comment">! pack.</span></div>
<div class="line">    <span class="keyword">call </span>field_pair%init(2)</div>
<div class="line"> </div>
<div class="line">    <span class="comment">! Assign the fields to the list, the first parameter is the index of the</span></div>
<div class="line">    <span class="comment">! field in the list, the second is the field itself.</span></div>
<div class="line">    <span class="keyword">call </span>field_pair%assign_to_field(1, my_field1)</div>
<div class="line">    <span class="keyword">call </span>field_pair%assign_to_field(2, my_field2)</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="comment">! Write the list of fields to a different file, they will be put in the</span></div>
<div class="line">    <span class="comment">! pressure and temperature inside the fld.</span></div>
<div class="line">    <span class="keyword">call </span>fld_writer%init(<span class="stringliteral">&quot;my_output2.fld&quot;</span>)</div>
<div class="line">    <span class="keyword">call </span>fld_writer%write(field_pair)</div>
<div class="line"> </div>
<div class="line">    <span class="comment">! If one has 3 fields in the list, they will instead be written as velocity</span></div>
<div class="line">    <span class="comment">! components. Further adding 1 will populate the pressure with the first</span></div>
<div class="line">    <span class="comment">! field and then the next 3 will be the velocity components. Adding a fifth</span></div>
<div class="line">    <span class="comment">! field will put it into temperature, and all consecutive fields will be</span></div>
<div class="line">    <span class="comment">! scalars.</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">! Finally, note that you can set the precision of the output by calling</span></div>
<div class="line">    <span class="keyword">call </span>fld_writer%set_precision(dp) <span class="comment">! &lt;- sets double precision output</span></div>
<div class="line">    <span class="keyword">call </span>fld_writer%set_precision(sp) <span class="comment">! &lt;- sets single precision output</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">!</span></div>
<div class="line">    <span class="comment">! WRITING CSV FILES</span></div>
<div class="line">    <span class="comment">!</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">! A vector_t can be used to pass values to a CSV file writer. Let us init</span></div>
<div class="line">    <span class="comment">! one to have 5 elements and set them to 3.0.</span></div>
<div class="line">    <span class="keyword">call </span>vec%init(5)</div>
<div class="line">    vec = 3.0_rp</div>
<div class="line"> </div>
<div class="line">    <span class="comment">! We initialize the CSV writer just like the fld writer.</span></div>
<div class="line">    <span class="keyword">call </span>csv_writer%init(<span class="stringliteral">&quot;my_output.csv&quot;</span>)</div>
<div class="line">    <span class="comment">! The writer can optionally add a header string to the file.</span></div>
<div class="line">    <span class="keyword">call </span>csv_writer%set_header(<span class="stringliteral">&quot;# p1, p2, p3, p4, p5&quot;</span>)</div>
<div class="line"> </div>
<div class="line">    <span class="comment">! This will write one line to the CSV.</span></div>
<div class="line">    <span class="keyword">call </span>csv_writer%write(vec)</div>
<div class="line"> </div>
<div class="line">    <span class="comment">! Let us add another line. A common scenario is that you will update a</span></div>
<div class="line">    <span class="comment">! vector at each time step, e.f. in user_check and then append the result</span></div>
<div class="line">    <span class="comment">! to the CSV file.</span></div>
<div class="line">    vec = 4.0_rp</div>
<div class="line">    <span class="keyword">call </span>csv_writer%write(vec)</div>
<div class="line"> </div>
<div class="line">    <span class="comment">! Note that the CSV writer will append to file, if it exists, so you have</span></div>
<div class="line">    <span class="comment">! to take care of that manually. Finally, note that one can also use</span></div>
<div class="line">    <span class="comment">! matrix_t objects to write to CSV files, in case you have 2D data.</span></div>
<div class="line"> </div>
<div class="line">  <span class="keyword">end subroutine </span><a class="code hl_function" href="../../dc/d44/namespaceuser.html#a2fd9b995e523d56e60c506dcc796a7c1">initialize</a></div>
<div class="line"> </div>
<div class="line">  <span class="keyword">subroutine </span><a class="code hl_function" href="../../dc/d44/namespaceuser.html#add0bbc1561124367d2a98f64884f07ae">finalize</a>(time)</div>
<div class="line">    <span class="keywordtype">type</span>(time_state_t), <span class="keywordtype">intent(in)</span> :: time</div>
<div class="line"> </div>
<div class="line">    <span class="comment">! Don&#39;t forget to free the objects you initialized</span></div>
<div class="line">    <span class="keyword">call </span>my_field1%free()</div>
<div class="line">    <span class="keyword">call </span>my_field2%free()</div>
<div class="line">    <span class="keyword">call </span>vec%free()</div>
<div class="line">  <span class="keyword">end subroutine </span><a class="code hl_function" href="../../dc/d44/namespaceuser.html#add0bbc1561124367d2a98f64884f07ae">finalize</a></div>
<div class="line"> </div>
<div class="line"><span class="keyword">end module </span><a class="code hl_namespace" href="../../dc/d44/namespaceuser.html">user</a></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md166"></a>
&lt;tt&gt;custom_types.f90&lt;/tt&gt;</h2>
<p>Shows how to add a new run-time-selectable type to Neko, using a source term as an example.</p>
<div class="fragment"><div class="line"><span class="comment">! Copyright (c) 2025, The Neko Authors</span></div>
<div class="line"><span class="comment">! All rights reserved.</span></div>
<div class="line"><span class="comment">!</span></div>
<div class="line"><span class="comment">! Redistribution and use in source and binary forms, with or without</span></div>
<div class="line"><span class="comment">! modification, are permitted provided that the following conditions</span></div>
<div class="line"><span class="comment">! are met:</span></div>
<div class="line"><span class="comment">!</span></div>
<div class="line"><span class="comment">!   * Redistributions of source code must retain the above copyright</span></div>
<div class="line"><span class="comment">!     notice, this list of conditions and the following disclaimer.</span></div>
<div class="line"><span class="comment">!</span></div>
<div class="line"><span class="comment">!   * Redistributions in binary form must reproduce the above</span></div>
<div class="line"><span class="comment">!     copyright notice, this list of conditions and the following</span></div>
<div class="line"><span class="comment">!     disclaimer in the documentation and/or other materials provided</span></div>
<div class="line"><span class="comment">!     with the distribution.</span></div>
<div class="line"><span class="comment">!</span></div>
<div class="line"><span class="comment">!   * Neither the name of the authors nor the names of its</span></div>
<div class="line"><span class="comment">!     contributors may be used to endorse or promote products derived</span></div>
<div class="line"><span class="comment">!     from this software without specific prior written permission.</span></div>
<div class="line"><span class="comment">!</span></div>
<div class="line"><span class="comment">! THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS</span></div>
<div class="line"><span class="comment">! &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT</span></div>
<div class="line"><span class="comment">! LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS</span></div>
<div class="line"><span class="comment">! FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE</span></div>
<div class="line"><span class="comment">! COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,</span></div>
<div class="line"><span class="comment">! INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,</span></div>
<div class="line"><span class="comment">! BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;</span></div>
<div class="line"><span class="comment">! LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER</span></div>
<div class="line"><span class="comment">! CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT</span></div>
<div class="line"><span class="comment">! LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN</span></div>
<div class="line"><span class="comment">! ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE</span></div>
<div class="line"><span class="comment">! POSSIBILITY OF SUCH DAMAGE.</span></div>
<div class="line"><span class="comment">!</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">!! After compiling this file with makeneko, you can add the following to your</span></div>
<div class="line"><span class="comment">!! JSON file to use this custom source term:</span></div>
<div class="line"><span class="comment">!!        &quot;source_terms&quot;: [</span></div>
<div class="line"><span class="comment">!!          {</span></div>
<div class="line"><span class="comment">!!            &quot;type&quot;: &quot;my_source_term&quot;,</span></div>
<div class="line"><span class="comment">!!            &quot;greeting&quot;: &quot;Hello there!&quot;</span></div>
<div class="line"><span class="comment">!!</span></div>
<div class="line"><span class="comment">!!          }</span></div>
<div class="line"><span class="comment">!!        ],</span></div>
<div class="line"><span class="comment">!! NOTE: the module name must be the same as the file name sans the extension.</span></div>
<div class="line"><span class="keyword">module</span> <a class="code hl_namespace" href="../../de/dba/namespacecustom__types.html">custom_types</a></div>
<div class="line">  <span class="keywordtype">use </span><a class="code hl_namespace" href="../../df/d48/namespacenum__types.html">num_types</a>, <span class="keywordtype">only</span> : <a class="code hl_variable" href="../../df/d48/namespacenum__types.html#ae2be59b6de7b874ce5c12fd87f9e8b5e">rp</a></div>
<div class="line">  <span class="keywordtype">use </span>json_module, <span class="keywordtype">only</span> : json_file</div>
<div class="line">  <span class="keywordtype">use </span><a class="code hl_namespace" href="../../d8/da8/namespacejson__utils.html">json_utils</a>, <span class="keywordtype">only</span>: <a class="code hl_interface" href="../../d7/d48/interfacejson__utils_1_1json__get.html">json_get</a>, <a class="code hl_interface" href="../../d0/d70/interfacejson__utils_1_1json__get__or__default.html">json_get_or_default</a></div>
<div class="line">  <span class="keywordtype">use </span><a class="code hl_namespace" href="../../df/d2b/namespacefield__list.html">field_list</a>, <span class="keywordtype">only</span> : <a class="code hl_struct" href="../../d3/d90/structfield__list_1_1field__list__t.html">field_list_t</a></div>
<div class="line">  <span class="keywordtype">use </span><a class="code hl_namespace" href="../../d8/d92/namespacetime__state.html">time_state</a>, <span class="keywordtype">only</span> : <a class="code hl_struct" href="../../d7/d90/structtime__state_1_1time__state__t.html">time_state_t</a></div>
<div class="line"> </div>
<div class="line">  <span class="comment">! These imports are needed for registering our new type with Neko</span></div>
<div class="line">  <span class="keywordtype">use </span><a class="code hl_namespace" href="../../de/de7/namespacesource__term.html">source_term</a>, <span class="keywordtype">only</span> : <a class="code hl_struct" href="../../d8/d03/structsource__term_1_1source__term__t.html">source_term_t</a>, register_source_term, &amp;</div>
<div class="line">       <a class="code hl_interface" href="../../d9/df0/interfacesource__term_1_1source__term__allocate.html">source_term_allocate</a></div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">use </span><a class="code hl_namespace" href="../../d6/dbe/namespacecoefs.html">coefs</a>, <span class="keywordtype">only</span> : <a class="code hl_struct" href="../../d0/dea/structcoefs_1_1coef__t.html">coef_t</a></div>
<div class="line">  <span class="keywordtype">implicit none</span></div>
<div class="line">  <span class="keywordtype">private</span></div>
<div class="line"> </div>
<div class="line">  <span class="keyword">type</span>, <span class="keyword">public</span>, <span class="keyword">extends</span>(<a class="code hl_struct" href="../../d8/d03/structsource__term_1_1source__term__t.html">source_term_t</a>) :: <a class="code hl_struct" href="../../d4/dc1/structcustom__types_1_1my__source__term__t.html">my_source_term_t</a></div>
<div class="line">     <span class="comment">! We will read this greeting from the JSON file.</span></div>
<div class="line">     <span class="keywordtype">character(len=:)</span>, <span class="keywordtype">allocatable</span> :: greeting</div>
<div class="line">   <span class="keyword">contains</span></div>
<div class="line">     <span class="keywordtype">procedure</span>, pass(this) :: init =&gt; <a class="code hl_function" href="../../de/dba/namespacecustom__types.html#af79935e10736365d29a4f15f973777e0">my_source_term_init_from_json</a></div>
<div class="line">     <span class="keywordtype">procedure</span>, pass(this) :: free =&gt; <a class="code hl_function" href="../../de/dba/namespacecustom__types.html#a938810a9b9889f45d6a8d39a4d347020">my_source_term_free</a></div>
<div class="line">     <span class="keywordtype">procedure</span>, pass(this) :: compute_ =&gt; <a class="code hl_function" href="../../de/dba/namespacecustom__types.html#a060584abcc6806c3274d2ddf8f9a2495">my_source_term_compute</a></div>
<div class="line">  <span class="keyword">end type </span><a class="code hl_struct" href="../../d4/dc1/structcustom__types_1_1my__source__term__t.html">my_source_term_t</a></div>
<div class="line"> </div>
<div class="line">  <span class="comment">! Have to make this public!</span></div>
<div class="line">  <span class="keywordtype">public</span> :: <a class="code hl_function" href="../../de/dba/namespacecustom__types.html#a4fc67e88bba163f8f7522a94e6681df2">custom_types_register_types</a></div>
<div class="line"> </div>
<div class="line"><span class="keyword">contains</span></div>
<div class="line">  <span class="keyword">subroutine </span><a class="code hl_function" href="../../de/dba/namespacecustom__types.html#af79935e10736365d29a4f15f973777e0">my_source_term_init_from_json</a>(this, json, fields, coef, &amp;</div>
<div class="line">       variable_name)</div>
<div class="line">    <span class="keywordtype">class</span>(my_source_term_t), <span class="keywordtype">intent(inout)</span> :: this</div>
<div class="line">    <span class="keywordtype">type</span>(json_file), <span class="keywordtype">intent(inout)</span> :: json</div>
<div class="line">    <span class="keywordtype">type</span>(field_list_t), <span class="keywordtype">intent(in)</span>, <span class="keywordtype">target</span> :: fields</div>
<div class="line">    <span class="keywordtype">type</span>(coef_t), <span class="keywordtype">intent(in)</span>, <span class="keywordtype">target</span> :: coef</div>
<div class="line">    <span class="keywordtype">character(len=*)</span>, <span class="keywordtype">intent(in)</span> :: variable_name</div>
<div class="line"><span class="keywordtype">    real</span>(kind=<a class="code hl_variable" href="../../df/d48/namespacenum__types.html#ae2be59b6de7b874ce5c12fd87f9e8b5e">rp</a>) :: start_time, end_time</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">call </span><a class="code hl_interface" href="../../d0/d70/interfacejson__utils_1_1json__get__or__default.html">json_get_or_default</a>(json, <span class="stringliteral">&quot;start_time&quot;</span>, start_time, 0.0_rp)</div>
<div class="line">    <span class="keyword">call </span><a class="code hl_interface" href="../../d0/d70/interfacejson__utils_1_1json__get__or__default.html">json_get_or_default</a>(json, <span class="stringliteral">&quot;end_time&quot;</span>, end_time, huge(0.0_rp))</div>
<div class="line"> </div>
<div class="line">    <span class="comment">! Start fresh</span></div>
<div class="line">    <span class="keyword">call </span>this%free()</div>
<div class="line">    <span class="comment">! Initialize the base class source_term_t</span></div>
<div class="line">    <span class="keyword">call </span>this%init_base(fields, coef, start_time, end_time)</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">call </span><a class="code hl_interface" href="../../d7/d48/interfacejson__utils_1_1json__get.html">json_get</a>(json, <span class="stringliteral">&quot;greeting&quot;</span>, this%greeting)</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">end subroutine </span><a class="code hl_function" href="../../de/dba/namespacecustom__types.html#af79935e10736365d29a4f15f973777e0">my_source_term_init_from_json</a></div>
<div class="line"> </div>
<div class="line">  <span class="keyword">subroutine </span><a class="code hl_function" href="../../de/dba/namespacecustom__types.html#a938810a9b9889f45d6a8d39a4d347020">my_source_term_free</a>(this)</div>
<div class="line">    <span class="keywordtype">class</span>(my_source_term_t), <span class="keywordtype">intent(inout)</span> :: this</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (<span class="keyword">allocated</span>(this%greeting)) <span class="keywordflow">then</span></div>
<div class="line">       <span class="keyword">deallocate</span>(this%greeting)</div>
<div class="line"><span class="keywordflow">    end if</span></div>
<div class="line">    <span class="keyword">call </span>this%free_base()</div>
<div class="line">  <span class="keyword">end subroutine </span><a class="code hl_function" href="../../de/dba/namespacecustom__types.html#a938810a9b9889f45d6a8d39a4d347020">my_source_term_free</a></div>
<div class="line"> </div>
<div class="line">  <span class="keyword">subroutine </span><a class="code hl_function" href="../../de/dba/namespacecustom__types.html#a060584abcc6806c3274d2ddf8f9a2495">my_source_term_compute</a>(this, time)</div>
<div class="line">    <span class="keywordtype">class</span>(my_source_term_t), <span class="keywordtype">intent(inout)</span> :: this</div>
<div class="line">    <span class="keywordtype">type</span>(time_state_t), <span class="keywordtype">intent(in)</span> :: time</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">write</span>(*,*) this%greeting</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">end subroutine </span><a class="code hl_function" href="../../de/dba/namespacecustom__types.html#a060584abcc6806c3274d2ddf8f9a2495">my_source_term_compute</a></div>
<div class="line"> </div>
<div class="line">  <span class="comment">! The name of this routine follows a convention: the name of the module +</span></div>
<div class="line">  <span class="comment">! register_types. This is where we call the register_source_term routine, or</span></div>
<div class="line">  <span class="comment">! a similar routine for other types. You can register as much types as you</span></div>
<div class="line">  <span class="comment">! want in this routine, in case you have several types in the module.</span></div>
<div class="line">  <span class="keyword">subroutine </span><a class="code hl_function" href="../../de/dba/namespacecustom__types.html#a4fc67e88bba163f8f7522a94e6681df2">custom_types_register_types</a>()</div>
<div class="line">    <span class="comment">! Just a helper variable</span></div>
<div class="line">    <span class="keywordtype">procedure</span>(source_term_allocate), <span class="keywordtype">pointer</span> :: allocator</div>
<div class="line"> </div>
<div class="line">    allocator =&gt; <a class="code hl_function" href="../../de/dba/namespacecustom__types.html#a1c339c71cd261f0318255b7372b86dc1">my_source_term_allocate</a></div>
<div class="line"> </div>
<div class="line">    <span class="comment">! Based on this the name of the source term will be &quot;my_source_term&quot;,</span></div>
<div class="line">    <span class="comment">! This is what you set in the JSON file, in the type keyword</span></div>
<div class="line">    <span class="keyword">call </span>register_source_term(<span class="stringliteral">&quot;my_source_term&quot;</span>, allocator)</div>
<div class="line">  <span class="keyword">end subroutine </span><a class="code hl_function" href="../../de/dba/namespacecustom__types.html#a4fc67e88bba163f8f7522a94e6681df2">custom_types_register_types</a></div>
<div class="line"> </div>
<div class="line">  <span class="comment">! This thing does nothing except allocate a polymorphic object to our new</span></div>
<div class="line">  <span class="comment">! custom type.</span></div>
<div class="line">  <span class="keyword">subroutine </span><a class="code hl_function" href="../../de/dba/namespacecustom__types.html#a1c339c71cd261f0318255b7372b86dc1">my_source_term_allocate</a>(obj)</div>
<div class="line">    <span class="keywordtype">class</span>(source_term_t), <span class="keywordtype">allocatable</span>, <span class="keywordtype">intent(inout)</span> :: obj</div>
<div class="line">    <span class="keyword">allocate</span>(<a class="code hl_struct" href="../../d4/dc1/structcustom__types_1_1my__source__term__t.html">my_source_term_t</a>::obj)</div>
<div class="line">  <span class="keyword">end subroutine </span><a class="code hl_function" href="../../de/dba/namespacecustom__types.html#a1c339c71cd261f0318255b7372b86dc1">my_source_term_allocate</a></div>
<div class="line"><span class="keyword">end module </span><a class="code hl_namespace" href="../../de/dba/namespacecustom__types.html">custom_types</a></div>
<div class="ttc" id="ainterfacejson__utils_1_1json__get__or__default_html"><div class="ttname"><a href="../../d0/d70/interfacejson__utils_1_1json__get__or__default.html">json_utils::json_get_or_default</a></div><div class="ttdoc">Retrieves a parameter by name or assigns a provided default value. In the latter case also adds the m...</div><div class="ttdef"><b>Definition</b> <a href="../../d6/d44/json__utils_8f90_source.html#l00057">json_utils.f90:57</a></div></div>
<div class="ttc" id="ainterfacejson__utils_1_1json__get_html"><div class="ttname"><a href="../../d7/d48/interfacejson__utils_1_1json__get.html">json_utils::json_get</a></div><div class="ttdoc">Retrieves a parameter by name or throws an error.</div><div class="ttdef"><b>Definition</b> <a href="../../d6/d44/json__utils_8f90_source.html#l00048">json_utils.f90:48</a></div></div>
<div class="ttc" id="ainterfacesource__term_1_1source__term__allocate_html"><div class="ttname"><a href="../../d9/df0/interfacesource__term_1_1source__term__allocate.html">source_term::source_term_allocate</a></div><div class="ttdoc">Source term factory. Both constructs and initializes the object.</div><div class="ttdef"><b>Definition</b> <a href="../../df/d69/source__term_8f90_source.html#l00150">source_term.f90:150</a></div></div>
<div class="ttc" id="anamespacecoefs_html"><div class="ttname"><a href="../../d6/dbe/namespacecoefs.html">coefs</a></div><div class="ttdoc">Coefficients.</div><div class="ttdef"><b>Definition</b> <a href="../../db/d85/coef_8f90_source.html#l00034">coef.f90:34</a></div></div>
<div class="ttc" id="anamespacecustom__types_html"><div class="ttname"><a href="../../de/dba/namespacecustom__types.html">custom_types</a></div><div class="ttdoc">In this module we implement a custom source term, my_source_term and prep it for being recognized by ...</div><div class="ttdef"><b>Definition</b> <a href="../../d6/d2a/custom__types_8f90_source.html#l00047">custom_types.f90:47</a></div></div>
<div class="ttc" id="anamespacecustom__types_html_a060584abcc6806c3274d2ddf8f9a2495"><div class="ttname"><a href="../../de/dba/namespacecustom__types.html#a060584abcc6806c3274d2ddf8f9a2495">custom_types::my_source_term_compute</a></div><div class="ttdeci">subroutine my_source_term_compute(this, time)</div><div class="ttdoc">Will just bring our greeting to the console.</div><div class="ttdef"><b>Definition</b> <a href="../../d6/d2a/custom__types_8f90_source.html#l00116">custom_types.f90:117</a></div></div>
<div class="ttc" id="anamespacecustom__types_html_a1c339c71cd261f0318255b7372b86dc1"><div class="ttname"><a href="../../de/dba/namespacecustom__types.html#a1c339c71cd261f0318255b7372b86dc1">custom_types::my_source_term_allocate</a></div><div class="ttdeci">subroutine my_source_term_allocate(obj)</div><div class="ttdef"><b>Definition</b> <a href="../../d6/d2a/custom__types_8f90_source.html#l00141">custom_types.f90:142</a></div></div>
<div class="ttc" id="anamespacecustom__types_html_a4fc67e88bba163f8f7522a94e6681df2"><div class="ttname"><a href="../../de/dba/namespacecustom__types.html#a4fc67e88bba163f8f7522a94e6681df2">custom_types::custom_types_register_types</a></div><div class="ttdeci">subroutine, public custom_types_register_types()</div><div class="ttdef"><b>Definition</b> <a href="../../d6/d2a/custom__types_8f90_source.html#l00128">custom_types.f90:129</a></div></div>
<div class="ttc" id="anamespacecustom__types_html_a938810a9b9889f45d6a8d39a4d347020"><div class="ttname"><a href="../../de/dba/namespacecustom__types.html#a938810a9b9889f45d6a8d39a4d347020">custom_types::my_source_term_free</a></div><div class="ttdeci">subroutine my_source_term_free(this)</div><div class="ttdoc">Destructor.</div><div class="ttdef"><b>Definition</b> <a href="../../d6/d2a/custom__types_8f90_source.html#l00105">custom_types.f90:106</a></div></div>
<div class="ttc" id="anamespacecustom__types_html_af79935e10736365d29a4f15f973777e0"><div class="ttname"><a href="../../de/dba/namespacecustom__types.html#af79935e10736365d29a4f15f973777e0">custom_types::my_source_term_init_from_json</a></div><div class="ttdeci">subroutine my_source_term_init_from_json(this, json, fields, coef, variable_name)</div><div class="ttdoc">The common constructor using a JSON object.</div><div class="ttdef"><b>Definition</b> <a href="../../d6/d2a/custom__types_8f90_source.html#l00083">custom_types.f90:85</a></div></div>
<div class="ttc" id="anamespacefield__list_html"><div class="ttname"><a href="../../df/d2b/namespacefield__list.html">field_list</a></div><div class="ttdef"><b>Definition</b> <a href="../../d1/d13/field__list_8f90_source.html#l00001">field_list.f90:1</a></div></div>
<div class="ttc" id="anamespacejson__utils_html"><div class="ttname"><a href="../../d8/da8/namespacejson__utils.html">json_utils</a></div><div class="ttdoc">Utilities for retrieving parameters from the case files.</div><div class="ttdef"><b>Definition</b> <a href="../../d6/d44/json__utils_8f90_source.html#l00034">json_utils.f90:34</a></div></div>
<div class="ttc" id="anamespacenum__types_html"><div class="ttname"><a href="../../df/d48/namespacenum__types.html">num_types</a></div><div class="ttdef"><b>Definition</b> <a href="../../dc/d99/num__types_8f90_source.html#l00001">num_types.f90:1</a></div></div>
<div class="ttc" id="anamespacenum__types_html_ae2be59b6de7b874ce5c12fd87f9e8b5e"><div class="ttname"><a href="../../df/d48/namespacenum__types.html#ae2be59b6de7b874ce5c12fd87f9e8b5e">num_types::rp</a></div><div class="ttdeci">integer, parameter, public rp</div><div class="ttdoc">Global precision used in computations.</div><div class="ttdef"><b>Definition</b> <a href="../../dc/d99/num__types_8f90_source.html#l00012">num_types.f90:12</a></div></div>
<div class="ttc" id="anamespacetime__state_html"><div class="ttname"><a href="../../d8/d92/namespacetime__state.html">time_state</a></div><div class="ttdoc">Module with things related to the simulation time.</div><div class="ttdef"><b>Definition</b> <a href="../../d7/dd6/time__state_8f90_source.html#l00034">time_state.f90:34</a></div></div>
<div class="ttc" id="astructcoefs_1_1coef__t_html"><div class="ttname"><a href="../../d0/dea/structcoefs_1_1coef__t.html">coefs::coef_t</a></div><div class="ttdoc">Coefficients defined on a given (mesh, ) tuple. Arrays use indices (i,j,k,e): element e,...</div><div class="ttdef"><b>Definition</b> <a href="../../db/d85/coef_8f90_source.html#l00056">coef.f90:56</a></div></div>
<div class="ttc" id="astructcustom__types_1_1my__source__term__t_html"><div class="ttname"><a href="../../d4/dc1/structcustom__types_1_1my__source__term__t.html">custom_types::my_source_term_t</a></div><div class="ttdef"><b>Definition</b> <a href="../../d6/d2a/custom__types_8f90_source.html#l00062">custom_types.f90:62</a></div></div>
<div class="ttc" id="astructfield__list_1_1field__list__t_html"><div class="ttname"><a href="../../d3/d90/structfield__list_1_1field__list__t.html">field_list::field_list_t</a></div><div class="ttdoc">field_list_t, To be able to group fields together</div><div class="ttdef"><b>Definition</b> <a href="../../d1/d13/field__list_8f90_source.html#l00015">field_list.f90:15</a></div></div>
<div class="ttc" id="astructsource__term_1_1source__term__t_html"><div class="ttname"><a href="../../d8/d03/structsource__term_1_1source__term__t.html">source_term::source_term_t</a></div><div class="ttdoc">Base abstract type for source terms.</div><div class="ttdef"><b>Definition</b> <a href="../../df/d69/source__term_8f90_source.html#l00044">source_term.f90:44</a></div></div>
<div class="ttc" id="astructtime__state_1_1time__state__t_html"><div class="ttname"><a href="../../d7/d90/structtime__state_1_1time__state__t.html">time_state::time_state_t</a></div><div class="ttdoc">A struct that contains all info about the time, expand as needed.</div><div class="ttdef"><b>Definition</b> <a href="../../d7/dd6/time__state_8f90_source.html#l00044">time_state.f90:44</a></div></div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="../../index.html">Neko Manual</a></li><li class="navelem"><a class="el" href="../../dd/d04/user-guide.html">User guide</a></li>
    <li class="footer">Generated on Sun Nov 23 2025 03:51:06 for Neko by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Neko: Point zones</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../doxygen-awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Neko
   &#160;<span id="projectnumber">0.9.99</span>
   </div>
   <div id="projectbrief">A portable framework for high-order spectral element flow simulations</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "../../search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('da/dd0/point-zones.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Point zones </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#autotoc_md66">What are point zones?</a></li>
<li class="level1"><a href="#autotoc_md67">Predefined geometrical shapes</a><ul><li class="level2"><a href="#autotoc_md68">Box</a></li>
<li class="level2"><a href="#autotoc_md69">Sphere</a></li>
<li class="level2"><a href="#autotoc_md70">Cylinder</a></li>
</ul>
</li>
<li class="level1"><a href="#autotoc_md71">Operations on point zones</a><ul><li class="level2"><a href="#autotoc_md72">Inversion</a></li>
<li class="level2"><a href="#autotoc_md73">Combination</a></li>
</ul>
</li>
<li class="level1"><a href="#autotoc_md74">User-defined geometrical shapes</a></li>
<li class="level1"><a href="#point-zones_using-point-zones">Using point zones</a></li>
</ul>
</div>
<div class="textblock"><p><a class="anchor" id="md_pages_user_guide_point_zones"></a></p>
<h1><a class="anchor" id="autotoc_md66"></a>
What are point zones?</h1>
<p>Point zones are subsections of the computational domain which are selected based on a given geometrical criterion. A point zone is defined by the <code>point_zone_t</code> abstract type. Each <code>point_zone_t</code> object has a unique <code>name</code> attribute, and a <code>mask</code> containing a list of linear indices referring to the GLL points whose coordinates verify the above-mentioned geometrical criterion. Zones can then be used for different purposes, an example being applying a localized source term or probing a particular zone of interest.</p>
<h1><a class="anchor" id="autotoc_md67"></a>
Predefined geometrical shapes</h1>
<p>There are three predefined shapes from which to initialize a point zone in the case file: boxes, spheres and cylinders. Each shape is described by its own subtype <code>box_point_zone_t</code>, <code>sphere_point_zone_t</code> and <code>cylinder_point_zone_t</code>, extending the abstract class <code>point_zone_t</code>.</p>
<h2><a class="anchor" id="autotoc_md68"></a>
Box</h2>
<p>A box is defined from its <code>x,y</code> and <code>z</code> boundaries.</p>
<div class="fragment"><div class="line">[</div>
<div class="line">    {</div>
<div class="line">        &quot;name&quot;: mybox,</div>
<div class="line">        &quot;geometry&quot;: &quot;box&quot;,</div>
<div class="line">        &quot;x_bounds&quot;: [-1.0, 1.0],</div>
<div class="line">        &quot;y_bounds&quot;: [-1.0, 1.0],</div>
<div class="line">        &quot;z_bounds&quot;: [-1.0, 1.0]</div>
<div class="line">    }</div>
<div class="line">]</div>
</div><!-- fragment --> <h2><a class="anchor" id="autotoc_md69"></a>
Sphere</h2>
<p>A sphere is defined by its center and its radius.</p>
<div class="fragment"><div class="line">[</div>
<div class="line">    {</div>
<div class="line">        &quot;name&quot;: &quot;mysphere&quot;,</div>
<div class="line">        &quot;geometry&quot;: &quot;sphere&quot;,</div>
<div class="line">        &quot;center&quot;: [0.0, 0.0, 0.0],</div>
<div class="line">        &quot;radius&quot;: 0.01</div>
<div class="line">    },</div>
<div class="line">]</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md70"></a>
Cylinder</h2>
<p>A cylinder is defined by its end points and its radius.</p>
<div class="fragment"><div class="line">[</div>
<div class="line">    {</div>
<div class="line">        &quot;name&quot;: &quot;mycylinder&quot;,</div>
<div class="line">        &quot;geometry&quot;: &quot;cylinder&quot;,</div>
<div class="line">        &quot;start&quot;: [0.0, 0.0, 0.0],</div>
<div class="line">        &quot;end&quot;: [0.0, 0.0, 1.0],</div>
<div class="line">        &quot;radius&quot;: 0.01</div>
<div class="line">    },</div>
<div class="line">]</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md71"></a>
Operations on point zones</h1>
<h2><a class="anchor" id="autotoc_md72"></a>
Inversion</h2>
<p>By setting the keyword <code>invert</code> to <code>true</code>, you can indicate that you want to select all the points <b>but</b> those inside the point zone.</p>
<div class="fragment"><div class="line">[</div>
<div class="line">    {</div>
<div class="line">        &quot;name&quot;: &quot;mycylinder&quot;,</div>
<div class="line">        &quot;geometry&quot;: &quot;cylinder&quot;,</div>
<div class="line">        &quot;start&quot;: [0.0, 0.0, 0.0],</div>
<div class="line">        &quot;end&quot;: [0.0, 0.0, 1.0],</div>
<div class="line">        &quot;radius&quot;: 0.01</div>
<div class="line">        &quot;invert&quot;: true,</div>
<div class="line">    },</div>
<div class="line">]</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md73"></a>
Combination</h2>
<p>It is possible to combine predefined shapes into a single point zone. This is achieved by the <code>combine_point_zone_t</code> type which can construct a point zone based on the geometrical parameters of each sub point zone or refer to already existing point zones. The mask of a combined point zone will not contain any duplicate points in case the subset point zones overlap.</p>
<p>Specifying which point zones to combine is done through the <code>subsets</code> array. In that array, you can specify:</p><ul>
<li>a reference to an already existing point zone, or</li>
<li>an internal point zone.</li>
</ul>
<dl class="section note"><dt>Note</dt><dd>The first method is useful for creating a new point zone out of a combination of already existing point zones. If you are referencing zones <code>p1</code> and <code>p2</code>, you will get a new point zone <code>p3</code>. All three of those will be accessible in the registry. The second method is useful if you want to create only one point zone using the geometric criteria of the internal ones. This means that if you create zone <code>p3</code> out of internal zones <code>p1</code> and <code>p2</code>, only <code>p3</code> will be created. This is useful if you do not explicitly need <code>p1</code> and <code>p2</code>, which will not be accessible in the registry. Use this method if you are using very large point zones and want to save memory.</dd></dl>
<p>In the code snippet below, the combine point zone named <code>"combined_box_and_sphere"</code> uses a subset of two zones:</p><ul>
<li><code>"mysphere"</code> is a reference to the external point zone above, and</li>
<li><code>"mybox"</code> is built internally. This means that <code>"mysphere"</code> will be accessible in the registry, whereas <code>"mybox"</code> will not.</li>
</ul>
<p>The combination will be performed according to a specified operator, which can take the values <code>"OR"</code>, <code>"AND"</code> or <code>"XOR"</code>. For example, if you try to combine two point zones <code>p1</code> and <code>p2</code>:</p><ul>
<li>The operator <code>OR</code> will select all the points that are both in <code>p1</code> <b>or</b> <code>p2</code>,</li>
<li>The operator <code>AND</code> will select all the points that are both in <code>p1</code> <b>and</b> <code>p2</code>,</li>
<li>The operator <code>XOR</code> (exclusive OR) will select all the points that are <b>either</b> in <code>p1</code> <b>or</b> in <code>p2</code>, but not both at the same time.</li>
</ul>
<dl class="section note"><dt>Note</dt><dd>You can also invert a <code>combine</code> point zone. </dd></dl>
<dl class="section attention"><dt>Attention</dt><dd>You can combine other <code>combine</code> point zones as long as they are in the correct order in the case file, as demonstrated in the code snippet below.</dd></dl>
<div class="fragment"><div class="line">[</div>
<div class="line">    {</div>
<div class="line">        &quot;name&quot;: &quot;mysphere&quot;,</div>
<div class="line">        &quot;geometry&quot;: &quot;sphere&quot;,</div>
<div class="line">        &quot;center&quot;: [0.0, 0.0, 0.0],</div>
<div class="line">        &quot;radius&quot;: 0.01</div>
<div class="line">    },</div>
<div class="line"> </div>
<div class="line">    {</div>
<div class="line">        &quot;name&quot;: &quot;combined_box_and_sphere&quot;,</div>
<div class="line">        &quot;geometry&quot;: &quot;combine&quot;,</div>
<div class="line">        &quot;operator&quot;: &quot;OR&quot;,</div>
<div class="line">        &quot;subsets&quot;:</div>
<div class="line">        [</div>
<div class="line">            {</div>
<div class="line">                &quot;name&quot;: &quot;mysphere&quot;</div>
<div class="line">            },</div>
<div class="line">            {</div>
<div class="line">                &quot;name&quot;: &quot;mybox&quot;,</div>
<div class="line">                &quot;geometry&quot;: &quot;box&quot;,</div>
<div class="line">                &quot;x_bounds&quot;: [-1.0, 1.0],</div>
<div class="line">                &quot;y_bounds&quot;: [-1.0, 1.0],</div>
<div class="line">                &quot;z_bounds&quot;: [-1.0, 1.0]</div>
<div class="line">            },</div>
<div class="line"> </div>
<div class="line">        ],</div>
<div class="line">    },</div>
<div class="line">    {</div>
<div class="line">        &quot;name&quot;: &quot;inverted_combination&quot;,</div>
<div class="line">        &quot;geometry&quot;: &quot;combine&quot;,</div>
<div class="line">        &quot;operator&quot;: &quot;OR&quot;,</div>
<div class="line">        &quot;invert&quot;: true,</div>
<div class="line">        &quot;subsets&quot;:</div>
<div class="line">        [</div>
<div class="line">            {&quot;name&quot;: &quot;combined_box_and_sphere&quot;},</div>
<div class="line">        ],</div>
<div class="line">    },</div>
<div class="line"> </div>
<div class="line">]</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md74"></a>
User-defined geometrical shapes</h1>
<p>The current version of Neko does not support user-defined shapes from the case file. That said, shapes can be defined manually into new types by extending <code>point_zone_t</code> and implementing the abstract <code>criterion</code> interface.</p>
<h1><a class="anchor" id="point-zones_using-point-zones"></a>
Using point zones</h1>
<p>Point zones defined in the case file are stored in a point zone registry, <code>neko_point_zone_registry</code>. The point zone registry allows for the retrieval of any <code>point_zone_t</code> object when needed. Once a <code>point_zone_t</code> object is retrieved, it can be used for e.g. applying a source term to a localized zone, as demonstrated below:</p>
<div class="fragment"><div class="line"><span class="keyword">subroutine </span>forcing(f,t)</div>
<div class="line">  <span class="keywordtype">class</span>(fluid_user_source_term_t), <span class="keywordtype">intent(inout)</span> :: f</div>
<div class="line"><span class="keywordtype">  real</span>(kind=rp), <span class="keywordtype">intent(in)</span> :: t</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">integer</span> :: i</div>
<div class="line">  <span class="keywordtype">class</span>(point_zone_t), <span class="keywordtype">pointer</span> :: my_point_zone</div>
<div class="line">  </div>
<div class="line">  my_point_zone =&gt; neko_point_zone_registry%get_point_zone(<span class="stringliteral">&quot;myzone&quot;</span>)</div>
<div class="line"> </div>
<div class="line">  <span class="comment">! Assign a constant forcing to my_point_zone</span></div>
<div class="line">  <span class="keywordflow">do</span> i = 1, my_point_zone%size</div>
<div class="line">     f%u(my_point_zone%mask(i), 1, 1, 1) = 2.0</div>
<div class="line"><span class="keywordflow">  end do</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">end subroutine </span>forcing</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="../../index.html">Neko Manual</a></li><li class="navelem"><a class="el" href="../../dd/d04/user-guide.html">User guide</a></li>
    <li class="footer">Generated on Wed Dec 11 2024 03:42:12 for Neko by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Neko: Code style</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../doxygen-awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Neko<span id="projectnumber">&#160;1.99.2</span>
   </div>
   <div id="projectbrief">A portable framework for high-order spectral element flow simulations</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('da/db6/code-style.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Code style</div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#autotoc_md10">Data types</a></li>
<li class="level1"><a href="#autotoc_md11">Enforcing rules</a><ul><li class="level2"><a href="#autotoc_md12">Tools</a><ul><li class="level3"><a href="#autotoc_md13">flint</a></li>
<li class="level3"><a href="#autotoc_md14">findent</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><p>Fortran code should conform to the Fortran 2008 standard and should use an indentation level of 2, except for the extra indentation within <code>do</code> <code>if</code>, <code>select</code> or <code>where</code> statements and for each level inside a structure e.g. <code>type</code>, <code>interface</code>, where the indentation level is 3, continuation statements, which should be indented by 5 and a 0 indentation is used for <code>module</code> or <code>contains</code> (except for <code>contains</code> inside a derived type, where a single indentation level is used). It should be noted that no indentation should be applied to the <code>case</code> statements contained in a <code>select case</code> block.</p>
<p>These are the default rules in Emacs' Fortran mode, an example is given below, additional information on the Emacs' Fortran mode can be found at <a href="https://emacsdocs.org/docs/emacs/Fortran">https://emacsdocs.org</a> and the full formatting script for emacs can be found at the <a href="https://github.com/emacs-mirror/emacs/blob/master/lisp/progmodes/f90.el">Emacs' GitHub</a>.</p>
<div class="fragment"><div class="line"><span class="keyword">module</span> example</div>
<div class="line">  <span class="keywordtype">use </span>mod</div>
<div class="line">  <span class="keywordtype">implicit none</span></div>
<div class="line"> </div>
<div class="line">  <span class="keyword">type</span> :: derived_t</div>
<div class="line">     <span class="keywordtype">integer</span> :: x</div>
<div class="line">   <span class="keyword">contains</span></div>
<div class="line">     <span class="keywordtype">procedure</span>, pass(this) :: bar</div>
<div class="line">  <span class="keyword">end type </span>derived_t</div>
<div class="line"> </div>
<div class="line"><span class="keyword">contains</span></div>
<div class="line"> </div>
<div class="line">  <span class="keyword">subroutine </span>foo(x, y)</div>
<div class="line">    <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: x</div>
<div class="line">    <span class="keywordtype">integer</span>, <span class="keywordtype">intent(inout)</span> :: y</div>
<div class="line"><span class="keywordtype">    real</span>(kind=rp) :: <span class="keywordtype">value</span></div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">do</span> i = 1, 10</div>
<div class="line">       ...</div>
<div class="line"><span class="keywordflow">    end do</span></div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (x .lt. y) <span class="keywordflow">then</span></div>
<div class="line">       ... this statement is very long &amp;</div>
<div class="line">            continues on the next line</div>
<div class="line"><span class="keywordflow">    end if</span></div>
<div class="line">    </div>
<div class="line">    <span class="keywordflow">select case</span> (x)</div>
<div class="line">    <span class="keywordflow">case</span> (1)</div>
<div class="line">       ...</div>
<div class="line">    <span class="keywordflow">case</span> (2)</div>
<div class="line">       ...</div>
<div class="line"><span class="keywordflow">    end select</span></div>
<div class="line"> </div>
<div class="line">  <span class="keyword">end subroutine </span>foo</div>
<div class="line"> </div>
<div class="line"><span class="keyword">end module </span>example</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md10"></a>
Data types</h1>
<p>For portability reasons, it is essential to only use data type kinds defined in <a class="el" href="../../dc/d99/num__types_8f90.html">num_types.f90</a> and avoid legacy constructs like <code>real*8</code> or <code>integer(kind=8)</code></p>
<p>Floating-point numbers should be declared using <code>real</code> with the kind <code>rp</code>, which is the configured working precision for Neko (defaults to double). If single, double or quad precision is explicitly needed, use the kinds <code>sp</code>, <code>dp</code> or <code>qp</code>, respectively. For 16, 32, or 64-bit integers, Neko has defined the kinds <code>i2</code>, <code>i4</code> or <code>i8</code>, respectively; however, for standard integers, it is perfectly fine to use a plain <code>integer</code>.</p>
<h1><a class="anchor" id="autotoc_md11"></a>
Enforcing rules</h1>
<p>Submitting a pull request to Neko requires that the code adheres to the linting rules and to the formatting. The linting will require that the code does not reduce the linting score of the repository, while the formatting should be completed for any modified files.</p>
<p>In addition to the indentation specified above, the following rules are enforced:</p>
<ul>
<li>Lines may not exceed 80 characters.</li>
<li>Do loop specification must have spaces <code>do i = 1, 10</code>.</li>
<li>Logical operators must have spaces around them <code>a .eq. b</code>.</li>
<li>The separator <code>::</code> must have a spaces around it when declaring variables.</li>
<li>Punctuations must have spaces after them <code>foo(b, c)</code>.</li>
<li>Context blocks must have a space before the parenthesis <code>if (a .eq. b)</code>.</li>
<li>Usage of OpenMP should be prepended with <code>!$</code>.</li>
<li>Indentation should be done with spaces, not tabs.</li>
<li>Use new syntax <code>type(kind)</code> instead of <code>type*8</code>.</li>
<li>Comment operator <code>!</code> must have a space before and after them <code>! This is a comment</code>.</li>
<li>Lines may not be terminated with a semicolon.</li>
<li>End statement should have a context block <code>end if</code>.</li>
<li>End statement should have a space before context specification <code>end if</code>.</li>
<li>Assignment operators must have spaces around them <code>a = b</code>.</li>
<li>Trailing white spaces is not allowed.</li>
<li>Double spaces are not allowed.</li>
<li>Precision of real numbers should be specified using <code>sp</code>, <code>dp</code> or <code>qp</code>.</li>
<li>Array declaration should use brackets instead of parentheses.</li>
<li>Should use <code>use mpi_f08</code> instead (or <code>use mpi</code> if not available).</li>
<li>Bare stop statement not allowed.</li>
<li>The use of bare <code>exit</code> statement is not allowed.</li>
<li>The use of the <code>goto</code> statement is not allowed.</li>
<li>The use of the <code>pause</code> statement is not allowed.</li>
<li>The use of the <code>include</code> statement is not allowed.</li>
</ul>
<p>However, there are some exceptions to these rules:</p>
<ul>
<li>The separator <code>::</code> may not have spaces around it in the case of a type declaration.</li>
<li>Spaces after the comma in a list of arguments or array indices may be omitted for single letter variable names and 2 digit numbers. For example, <code>foo(a,b)</code> and <code>foo(a,10)</code> are allowed, but <code>foo(a,bb)</code> and <code>foo(a,100)</code> are not.</li>
<li>Spaces after the comma are not required in format specifiers.</li>
<li>Spaces around the <code>=</code> operator are not required in type declarations.</li>
</ul>
<h2><a class="anchor" id="autotoc_md12"></a>
Tools</h2>
<p>In order to simplify compliance to the formatting and linting rules the following tools can be used:</p>
<ul>
<li><a href="https://github.com/marshallward/flint">flint</a> to test the linting compliance.</li>
<li><a href="https://github.com/wvermin/findent">findent</a> to apply the formatting rules.</li>
</ul>
<p>We have scripts available under the <code>contrib/lint_format</code> directory that can be used to lint and format the code. The scripts are <code>lint.sh</code> and <code>format.sh</code> respectively.</p>
<h3><a class="anchor" id="autotoc_md13"></a>
flint</h3>
<p>The linting rules are enforced by the <a href="https://github.com/marshallward/flint">flint</a> tool. The rules are defined in the <code>flinter_rc.yml</code> file in the root of the repository.</p>
<p>Please note, newer versions of flint fails to execute for some of our large files (<a class="el" href="../../d8/ddc/htable_8f90.html">htable.f90</a> and <a class="el" href="../../de/de6/stack_8f90.html">stack.f90</a>).</p>
<p>One way to install flint is through pip: </p><div class="fragment"><div class="line">pip install nobvisual==0.2.0 flinter==0.4.0</div>
</div><!-- fragment --><p>To test your code against the linting rules, you can run the following command:</p>
<div class="fragment"><div class="line">flint score -r flinter_rc.yml &lt;file&gt;.f90</div>
</div><!-- fragment --><p> The whole src directory can be checked with: </p><div class="fragment"><div class="line">flint score -r flinter_rc.yml src/</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md14"></a>
findent</h3>
<p>This tool can be used to enforce these rules by assigning the following options. The documentation of <code>findent</code> provide details for emacs, vim and gedit. For VSCode, the <a href="https://marketplace.visualstudio.com/items?itemName=fortran-lang.linter-gfortran">Modern Fortran</a> extension provides an integration.</p>
<div class="fragment"><div class="line">pip install findent</div>
<div class="line">findent -Rr -i2 -d3 -f3 -s3 -w3 -t3 -j3 -k- --ws_remred --indent_ampersand --openmp=0 &lt; file.f90 &gt; file.f90.tmp</div>
<div class="line">mv file.f90.tmp file.f90</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="../../index.html">Neko Manual</a></li><li class="navelem"><a class="el" href="../../dc/d70/developer-guide.html">Developer guide</a></li>
    <li class="footer">Generated on Tue Dec 9 2025 03:48:59 for Neko by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>

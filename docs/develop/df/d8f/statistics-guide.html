<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Neko: Statistics guide</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../doxygen-awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Neko
   &#160;<span id="projectnumber">0.9.99</span>
   </div>
   <div id="projectbrief">A portable framework for high-order spectral element flow simulations</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "../../search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('df/d8f/statistics-guide.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Statistics guide </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#autotoc_md81">Using statistics</a></li>
<li class="level1"><a href="#autotoc_md82">List of fields in output files</a></li>
<li class="level1"><a href="#autotoc_md83">Postprocessing</a></li>
</ul>
</div>
<div class="textblock"><p><a class="anchor" id="md_pages_user_guide_statistics_guide"></a></p>
<p>Statistics in the context of Neko, is the common name for fields that are averaged in time and possible also space.</p>
<p>The statistics module in Neko computes the temporal average of a wide range of fields.</p>
<p>In this page we use the following convention for a field</p><ul>
<li>\( u \), the instantaneous field.</li>
<li>\( \langle u \rangle_t \), the temporal average of \( u \).</li>
<li>\( u = \langle u \rangle + u&#39; \), the Reynolds decomposition of \( u \), where \( u&#39; \) is the fluctuation of \( u \) around the mean field.</li>
</ul>
<p>The temporal average of a field \(u\) is the approximation of the integral</p>
<p>$$ \langle u \rangle_t = \int_{T_0}^{T_N} u dt $$</p>
<p>In Neko, this is computed as</p>
<p>$$ \langle u \rangle_t = \sum_{i=0}^N u_i \Delta t_i $$ where \( u_0 \) is the fields value at \( T_0 \) and \( N \) is the number of time steps needed to reach \( T_N \), \( T_N = T_0 + \sum_{i=0}^N \Delta t_i \).</p>
<p>In the statistics in Neko, various averages of the the different velocity components, derivatives and pressure are computed. In total, 44 "raw statistics" are computed that are required to compute the Reynolds stress budgets, mean fields, and the different terms in the turbulent kinetic energy equation.</p>
<h1><a class="anchor" id="autotoc_md81"></a>
Using statistics</h1>
<p>Statistics are enable in the the case file as a simcomp with the added argument <code>avg_direction</code>, <code>set_of_stats</code>, and <code>start_time</code>:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Name   </th><th class="markdownTableHeadNone">Description   </th><th class="markdownTableHeadNone">Admissible values   </th><th class="markdownTableHeadNone">Default value    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>start_time</code>   </td><td class="markdownTableBodyNone">Time at which to start gathering statistics.   </td><td class="markdownTableBodyNone">Positive real   </td><td class="markdownTableBodyNone">0    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>avg_direction</code>   </td><td class="markdownTableBodyNone">Directions to compute spatial average.   </td><td class="markdownTableBodyNone">x,y,z,xy,xz,yz   </td><td class="markdownTableBodyNone">No spatial average    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>set_of_stats</code>   </td><td class="markdownTableBodyNone">What set of stats to compute.   </td><td class="markdownTableBodyNone">basic, full   </td><td class="markdownTableBodyNone">full    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>compute_value</code>   </td><td class="markdownTableBodyNone">Interval, in timesteps or simulationtime, depending on compute_control, for sampling the flow fields for statistics.   </td><td class="markdownTableBodyNone">Positive real or int   </td><td class="markdownTableBodyNone">Not set (but recommended with every 50 timesteps or so   </td></tr>
</table>
<p>In addition to the usual controls for the output, which then outputs the averages computes from the last time the statistics were written to file.</p>
<p>For example, if one wants to compute only the basic statistics and sample the fields every 4 time steps and compute and output batches every 20 time units and have an initial transient of 60 time units the following would work:</p>
<div class="fragment"><div class="line">&quot;simulation_components&quot;: </div>
<div class="line">  [</div>
<div class="line">    {</div>
<div class="line">      &quot;type&quot;: &quot;fluid_stats&quot;,</div>
<div class="line">      &quot;compute_control&quot;: &quot;tsteps&quot;,</div>
<div class="line">      &quot;compute_value&quot;: 4,</div>
<div class="line">      &quot;output_control&quot;: &quot;simulationtime&quot;,</div>
<div class="line">      &quot;output_value&quot;: 20,</div>
<div class="line">      &quot;start_time&quot;:60.0,</div>
<div class="line">      &quot;avg_direction&quot;:&quot;xz&quot;,</div>
<div class="line">      &quot;set_of_stats&quot;:&quot;basic&quot;</div>
<div class="line">    }1</div>
<div class="line">  ]</div>
</div><!-- fragment --><p>Preferably set the initial transient to a multiple of output_value as otherwise the first output will be slightly shorter than the rest. The code related to fluid statistics are located in <a class="el" href="../../d9/d7d/namespacefluid__stats.html" title="Computes various statistics for the fluid fields. We use the Reynolds decomposition for a field u =  ...">fluid_stats</a> and <a class="el" href="../../dd/dc6/namespacefluid__stats__simcomp.html" title="Implements the fluid_stats_simcomp_t type.">fluid_stats_simcomp</a>.</p>
<p>The argument "avg_direction" is optional and if ignored we output 3d fields. The statistics are saved in a fld file according to the following in 2D and 3D. Observe that in 2D the mean Z-velocity is stored in a last scalar field. All other fields are kept the same. This is due to a limitation of the fld file format.</p>
<p>For 1D statistics a CSV file is outputted. The first column is the time at which the statistics are collected, the second column the spatial coordinate, and the rest of the data is stored in the order below. In this case all statistics are kept in the same order as in 3D.</p>
<h1><a class="anchor" id="autotoc_md82"></a>
List of fields in output files</h1>
<p>When only the basic set of stats is enabled, only stats 1-11 are computed. When 2D stats are enabled \( \langle w \rangle \) is stored in s7 for basic stats and in s40 for the full set of statistics.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Number   </th><th class="markdownTableHeadNone">Statistic   </th><th class="markdownTableHeadNone">Stored in variable (for fld files)    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">1   </td><td class="markdownTableBodyNone">\( \langle p \rangle \)   </td><td class="markdownTableBodyNone">Pressure    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">2   </td><td class="markdownTableBodyNone">\( \langle u \rangle \)   </td><td class="markdownTableBodyNone">X-Velocity    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">3   </td><td class="markdownTableBodyNone">\( \langle v \rangle \)   </td><td class="markdownTableBodyNone">Y-Velocity    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">4   </td><td class="markdownTableBodyNone">\( \langle w \rangle \)   </td><td class="markdownTableBodyNone">Z-Velocity    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">5   </td><td class="markdownTableBodyNone">\( \langle pp \rangle \)   </td><td class="markdownTableBodyNone">Temperature    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">6   </td><td class="markdownTableBodyNone">\( \langle uu \rangle \)   </td><td class="markdownTableBodyNone">Scalar 1 (s1)    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">7   </td><td class="markdownTableBodyNone">\( \langle vv \rangle \)   </td><td class="markdownTableBodyNone">Scalar 2 (s2)    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">8   </td><td class="markdownTableBodyNone">\( \langle ww \rangle \)   </td><td class="markdownTableBodyNone">s3    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">9   </td><td class="markdownTableBodyNone">\( \langle uv \rangle \)   </td><td class="markdownTableBodyNone">s4    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">10   </td><td class="markdownTableBodyNone">\( \langle uw \rangle \)   </td><td class="markdownTableBodyNone">s5    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">11   </td><td class="markdownTableBodyNone">\( \langle vw \rangle \)   </td><td class="markdownTableBodyNone">s6    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">12   </td><td class="markdownTableBodyNone">\( \langle uuu \rangle \)   </td><td class="markdownTableBodyNone">s7    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">13   </td><td class="markdownTableBodyNone">\( \langle vvv \rangle \)   </td><td class="markdownTableBodyNone">s8    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">14   </td><td class="markdownTableBodyNone">\( \langle www \rangle \)   </td><td class="markdownTableBodyNone">s9    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">15   </td><td class="markdownTableBodyNone">\( \langle uuv \rangle \)   </td><td class="markdownTableBodyNone">s10    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">16   </td><td class="markdownTableBodyNone">\( \langle uuw \rangle \)   </td><td class="markdownTableBodyNone">s11    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">17   </td><td class="markdownTableBodyNone">\( \langle uvv \rangle \)   </td><td class="markdownTableBodyNone">s12    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">18   </td><td class="markdownTableBodyNone">\( \langle uvw \rangle \)   </td><td class="markdownTableBodyNone">s13    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">19   </td><td class="markdownTableBodyNone">\( \langle vvw \rangle \)   </td><td class="markdownTableBodyNone">s14    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">20   </td><td class="markdownTableBodyNone">\( \langle uww \rangle \)   </td><td class="markdownTableBodyNone">s15    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">21   </td><td class="markdownTableBodyNone">\( \langle vww \rangle \)   </td><td class="markdownTableBodyNone">s16    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">22   </td><td class="markdownTableBodyNone">\( \langle uuuu \rangle \)   </td><td class="markdownTableBodyNone">s17    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">23   </td><td class="markdownTableBodyNone">\( \langle vvvv \rangle \)   </td><td class="markdownTableBodyNone">s18    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">24   </td><td class="markdownTableBodyNone">\( \langle wwww \rangle \)   </td><td class="markdownTableBodyNone">s19    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">25   </td><td class="markdownTableBodyNone">\( \langle ppp \rangle \)   </td><td class="markdownTableBodyNone">s20    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">26   </td><td class="markdownTableBodyNone">\( \langle pppp \rangle \)   </td><td class="markdownTableBodyNone">s21    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">27   </td><td class="markdownTableBodyNone">\( \langle pu \rangle \)   </td><td class="markdownTableBodyNone">s22    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">28   </td><td class="markdownTableBodyNone">\( \langle pv \rangle \)   </td><td class="markdownTableBodyNone">s23    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">29   </td><td class="markdownTableBodyNone">\( \langle pw \rangle \)   </td><td class="markdownTableBodyNone">s24    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">30   </td><td class="markdownTableBodyNone">\( \langle p \frac{\partial u} {\partial x} \rangle \)   </td><td class="markdownTableBodyNone">s25    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">31   </td><td class="markdownTableBodyNone">\( \langle p \frac{\partial u} {\partial y}\rangle \)   </td><td class="markdownTableBodyNone">s26    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">32   </td><td class="markdownTableBodyNone">\( \langle p \frac{\partial u} {\partial z}\rangle \)   </td><td class="markdownTableBodyNone">s27    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">33   </td><td class="markdownTableBodyNone">\( \langle p \frac{\partial v} {\partial x}\rangle \)   </td><td class="markdownTableBodyNone">s28    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">34   </td><td class="markdownTableBodyNone">\( \langle p \frac{\partial v} {\partial y}\rangle \)   </td><td class="markdownTableBodyNone">s29    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">35   </td><td class="markdownTableBodyNone">\( \langle p \frac{\partial v} {\partial z}\rangle \)   </td><td class="markdownTableBodyNone">s30    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">36   </td><td class="markdownTableBodyNone">\( \langle p \frac{\partial w} {\partial x}\rangle \)   </td><td class="markdownTableBodyNone">s31    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">37   </td><td class="markdownTableBodyNone">\( \langle p \frac{\partial w} {\partial y}\rangle \)   </td><td class="markdownTableBodyNone">s32    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">38   </td><td class="markdownTableBodyNone">\( \langle p \frac{\partial w} {\partial z}\rangle \)   </td><td class="markdownTableBodyNone">s33    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">39   </td><td class="markdownTableBodyNone">\( \langle e11 \rangle \)   </td><td class="markdownTableBodyNone">s34    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">40   </td><td class="markdownTableBodyNone">\( \langle e22 \rangle \)   </td><td class="markdownTableBodyNone">s35    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">41   </td><td class="markdownTableBodyNone">\( \langle e33 \rangle \)   </td><td class="markdownTableBodyNone">s36    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">42   </td><td class="markdownTableBodyNone">\( \langle e12 \rangle \)   </td><td class="markdownTableBodyNone">s37    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">43   </td><td class="markdownTableBodyNone">\( \langle e13 \rangle \)   </td><td class="markdownTableBodyNone">s38    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">44   </td><td class="markdownTableBodyNone">\( \langle e23 \rangle \)   </td><td class="markdownTableBodyNone">s39   </td></tr>
</table>
<p>where \(e11,e22...\) is computed as: $$ \begin{aligned} e11 &amp;= \left(\frac{\partial u}{\partial x}\right)^2 + \left(\frac{\partial u}{\partial y}\right)^2 + \left(\frac{\partial u}{\partial z}\right)^2 \\ e22 &amp;= \left(\frac{\partial v}{\partial x}\right)^2 + \left(\frac{\partial v}{\partial y}\right)^2 + \left(\frac{\partial v}{\partial z}\right)^2 \\ e33 &amp;= \left(\frac{\partial w}{\partial x}\right)^2 + \left(\frac{\partial w}{\partial y}\right)^2 + \left(\frac{\partial w}{\partial z}\right)^2 \\ e12 &amp;= \frac{\partial u}{\partial x} \frac{\partial v}{\partial x} + \frac{\partial u}{\partial y}\frac{\partial v}{\partial y}+ \frac{\partial u}{\partial z}\frac{\partial v}{\partial z} \\ e13 &amp;= \frac{\partial u}{\partial x} \frac{\partial w}{\partial x} + \frac{\partial u}{\partial y}\frac{\partial w}{\partial y}+ \frac{\partial u}{\partial z}\frac{\partial w}{\partial z} \\ e23 &amp;= \frac{\partial v}{\partial x} \frac{\partial w}{\partial x} + \frac{\partial v}{\partial y}\frac{\partial w}{\partial y}+ \frac{\partial v}{\partial z}\frac{\partial w}{\partial z} \\ \end{aligned} $$</p>
<h1><a class="anchor" id="autotoc_md83"></a>
Postprocessing</h1>
<p>These statistics are only the "raw statistics" in the sense that in general we are not interested in \( \langle uu\rangle \), but rather say \( \langle u&#39;u&#39;\rangle\). For this we need to postprocess the statistics.</p>
<p>There is some rudimentary postprocessing to compute the spatial averages of fld files and also to combine the statistics collected from several runs (compute average in time) and also compute both the mean velocity gradient and the Reynolds stresses available in the contrib scripts. By running the contrib scripts without any arguments one gets a hint on their usage, (e.g. by running <code>./average_fields_in_time</code> will give the options).</p>
<p>To further postprocess the statistics it is suggested to look into PyNekTools which introduces convenient functions for postprocessing, largely based on the PyMech library with the addition of an expanding set of tools for interpolation, computing derivatives and more advanced functionality. PyNekTools is entirely parallelized in MPI and can also handle large data sets for postprocessing. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="../../index.html">Neko Manual</a></li><li class="navelem"><a class="el" href="../../dd/d04/user-guide.html">User guide</a></li>
    <li class="footer">Generated on Sun Dec 15 2024 03:43:12 for Neko by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
